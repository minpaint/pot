# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é OT_online

–ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ö—Ä–∞–Ω–æ–π —Ç—Ä—É–¥–∞ –Ω–∞ –¥–æ–º–∞—à–Ω–µ–º —Å–µ—Ä–≤–µ—Ä–µ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –¥–µ–ø–ª–æ–µ–º —á–µ—Ä–µ–∑ GitHub Actions.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–µ–ø–ª–æ—è](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–¥–µ–ø–ª–æ—è)
- [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É](#—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è-–∫-—Å–µ—Ä–≤–µ—Ä—É)
- [–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞](#–ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-—Å–µ—Ä–≤–µ—Ä–∞)
- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Actions](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-github-actions)
- [–†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π](#—Ä—É—á–Ω–æ–π-–¥–µ–ø–ª–æ–π)
- [–î–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ CWP](#-–¥–µ–ø–ª–æ–π-—á–µ—Ä–µ–∑-cwp-apache--nginx)
- [–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –º–∏–≥—Ä–∞—Ü–∏–∏](#–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è-–∏-–º–∏–≥—Ä–∞—Ü–∏–∏)
- [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–ª–æ–≥–∏)
- [–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ä–µ–∑–µ—Ä–≤–Ω–æ–µ-–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º](#—Ä–µ—à–µ–Ω–∏–µ-–ø—Ä–æ–±–ª–µ–º)

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–µ–ø–ª–æ—è

```
–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (Windows)
        ‚Üì
    git push
        ‚Üì
    GitHub Repository
        ‚Üì
  GitHub Actions (CI/CD)
        ‚Üì
    SSH Deploy
        ‚Üì
–î–æ–º–∞—à–Ω–∏–π —Å–µ—Ä–≤–µ—Ä (Linux)
    ‚îú‚îÄ‚îÄ Nginx (–≤–µ–±-—Å–µ—Ä–≤–µ—Ä)
    ‚îú‚îÄ‚îÄ Gunicorn (WSGI)
    ‚îú‚îÄ‚îÄ Django (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
    ‚îî‚îÄ‚îÄ PostgreSQL (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
```

---

## üíª –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- **–û–°**: Ubuntu 20.04+ / Debian 11+
- **RAM**: 2 GB (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 4 GB)
- **CPU**: 2 —è–¥—Ä–∞
- **–î–∏—Å–∫**: 20 GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- **Python**: 3.10+
- **PostgreSQL**: 14+
- **Nginx**: 1.18+

### –ù–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –ü–û:
```bash
sudo apt update
sudo apt install -y python3 python3-pip python3-venv \
    postgresql postgresql-contrib nginx git
```

---

## üîß –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# –°–æ–∑–¥–∞—ë–º —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
sudo useradd -m -s /bin/bash ot_user

# –î–æ–±–∞–≤–ª—è–µ–º –≤ –≥—Ä—É–ø–ø—É www-data –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Nginx
sudo usermod -aG www-data ot_user
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL

```bash
# –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è postgres
sudo -u postgres psql

-- –í psql —Å–æ–∑–¥–∞—ë–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
CREATE DATABASE ot_online;
CREATE USER ot_user WITH PASSWORD 'your_secure_password';
ALTER ROLE ot_user SET client_encoding TO 'utf8';
ALTER ROLE ot_user SET default_transaction_isolation TO 'read committed';
ALTER ROLE ot_user SET timezone TO 'Europe/Moscow';
GRANT ALL PRIVILEGES ON DATABASE ot_online TO ot_user;
\q
```

### 3. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
# –°–æ–∑–¥–∞—ë–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞
sudo mkdir -p /var/www/ot_online
sudo chown -R ot_user:www-data /var/www/ot_online
sudo chmod 755 /var/www/ot_online

# –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–æ–µ–∫—Ç–∞
sudo su - ot_user

# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
cd /var/www/ot_online
git clone https://github.com/minpaint/OT_online.git .
```

### 4. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –°–æ–∑–¥–∞—ë–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python3 -m venv venv

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º
source venv/bin/activate

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install --upgrade pip
pip install -r requirements.txt
```

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ö–æ–ø–∏—Ä—É–µ–º –ø—Ä–∏–º–µ—Ä .env
cp .env.example .env

# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º .env
nano .env
```

**–í–∞–∂–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`:**

```bash
# Django
DJANGO_SECRET_KEY=your-generated-secret-key-here
DJANGO_DEBUG=False
DJANGO_ALLOWED_HOSTS=yourdomain.com,www.yourdomain.com
DJANGO_SETTINGS_MODULE=settings_prod

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=postgresql://ot_user:your_secure_password@localhost:5432/ot_online

# Exam subdomain
EXAM_SUBDOMAIN=exam.yourdomain.com
EXAM_PROTOCOL=https

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
CSRF_TRUSTED_ORIGINS=https://yourdomain.com,https://exam.yourdomain.com
```

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è SECRET_KEY:**
```bash
python -c 'from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())'
```

### 6. –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –∏ —Å–±–æ—Ä–∫–∞ —Å—Ç–∞—Ç–∏–∫–∏

```bash
# –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏–∏
python manage.py migrate

# –°–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏–∫—É
python manage.py collectstatic --noinput

# –°–æ–∑–¥–∞—ë–º —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
python manage.py createsuperuser
```

### 7. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Gunicorn –∫–∞–∫ —Å–∏—Å—Ç–µ–º–Ω–æ–π —Å–ª—É–∂–±—ã

–°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª —Å–ª—É–∂–±—ã:
```bash
sudo nano /etc/systemd/system/ot_online.service
```

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:
```ini
[Unit]
Description=OT_online Gunicorn daemon
After=network.target postgresql.service

[Service]
Type=notify
User=ot_user
Group=www-data
RuntimeDirectory=gunicorn
WorkingDirectory=/var/www/ot_online
Environment="PATH=/var/www/ot_online/venv/bin"
Environment="DJANGO_SETTINGS_MODULE=settings_prod"
EnvironmentFile=/var/www/ot_online/.env
ExecStart=/var/www/ot_online/venv/bin/gunicorn \
    --workers 3 \
    --bind unix:/run/gunicorn/ot_online.sock \
    --timeout 60 \
    --log-level info \
    --access-logfile /var/log/ot_online/access.log \
    --error-logfile /var/log/ot_online/error.log \
    wsgi:application
ExecReload=/bin/kill -s HUP $MAINPID
KillMode=mixed
TimeoutStopSec=5
PrivateTmp=true

[Install]
WantedBy=multi-user.target
```

–°–æ–∑–¥–∞—ë–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ª–æ–≥–æ–≤:
```bash
sudo mkdir -p /var/log/ot_online
sudo chown -R ot_user:www-data /var/log/ot_online
```

–ó–∞–ø—É—Å–∫–∞–µ–º —Å–ª—É–∂–±—É:
```bash
sudo systemctl daemon-reload
sudo systemctl start ot_online
sudo systemctl enable ot_online
sudo systemctl status ot_online
```

### 8. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx

–°–æ–∑–¥–∞—ë–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
```bash
sudo nano /etc/nginx/sites-available/ot_online
```

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:
```nginx
# –û—Å–Ω–æ–≤–Ω–æ–π –¥–æ–º–µ–Ω
server {
    listen 80;
    server_name yourdomain.com www.yourdomain.com;

    # –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ HTTPS (–ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è SSL)
    # return 301 https://$server_name$request_uri;

    client_max_body_size 50M;

    location /static/ {
        alias /var/www/ot_online/staticfiles/;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }

    location /media/ {
        alias /var/www/ot_online/media/;
        expires 7d;
    }

    location / {
        include proxy_params;
        proxy_pass http://unix:/run/gunicorn/ot_online.sock;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Host $http_host;
        proxy_redirect off;
    }
}

# Exam –ø–æ–¥–¥–æ–º–µ–Ω
server {
    listen 80;
    server_name exam.yourdomain.com;

    # –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ HTTPS (–ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è SSL)
    # return 301 https://$server_name$request_uri;

    client_max_body_size 50M;

    location /static/ {
        alias /var/www/ot_online/staticfiles/;
        expires 30d;
    }

    location /media/ {
        alias /var/www/ot_online/media/;
        expires 7d;
    }

    location / {
        include proxy_params;
        proxy_pass http://unix:/run/gunicorn/ot_online.sock;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Host $http_host;
        proxy_redirect off;
    }

    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –¥–ª—è exam –ø–æ–¥–¥–æ–º–µ–Ω–∞
    add_header X-Robots-Tag "noindex, nofollow, noarchive" always;
}
```

–ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
```bash
sudo ln -s /etc/nginx/sites-available/ot_online /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### 9. –ü–æ–ª—É—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (Let's Encrypt)

```bash
# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º certbot
sudo apt install certbot python3-certbot-nginx

# –ü–æ–ª—É—á–∞–µ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–ª—è –æ–±–æ–∏—Ö –¥–æ–º–µ–Ω–æ–≤
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com -d exam.yourdomain.com

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
sudo certbot renew --dry-run
```

---

## üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Actions

### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SSH –∫–ª—é—á–∞ –¥–ª—è –¥–µ–ø–ª–æ—è

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º SSH –∫–ª—é—á (–±–µ–∑ –ø–∞—Ä–æ–ª—è)
ssh-keygen -t ed25519 -C "github-actions-deploy" -f ~/.ssh/github_deploy

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤ authorized_keys
cat ~/.ssh/github_deploy.pub >> ~/.ssh/authorized_keys

# –í—ã–≤–æ–¥–∏–º –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
cat ~/.ssh/github_deploy
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ GitHub

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings ‚Üí Secrets and variables ‚Üí Actions** –≤–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ –¥–æ–±–∞–≤—å—Ç–µ:

| –ò–º—è —Å–µ–∫—Ä–µ—Ç–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------------|----------|----------|
| `SSH_PRIVATE_KEY` | –°–æ–¥–µ—Ä–∂–∏–º–æ–µ `~/.ssh/github_deploy` | –ü—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á |
| `SERVER_HOST` | `192.168.1.100` –∏–ª–∏ `yourdomain.com` | IP –∏–ª–∏ –¥–æ–º–µ–Ω —Å–µ—Ä–≤–µ—Ä–∞ |
| `SERVER_USER` | `ot_user` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–ª—è SSH |
| `PROJECT_DIR` | `/var/www/ot_online` | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞ |

### 3. –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ sudo –±–µ–∑ –ø–∞—Ä–æ–ª—è –¥–ª—è —Ä–µ—Å—Ç–∞—Ä—Ç–∞ —Å–ª—É–∂–±—ã

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
sudo visudo
```

–î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞:
```
ot_user ALL=(ALL) NOPASSWD: /bin/systemctl restart ot_online
ot_user ALL=(ALL) NOPASSWD: /bin/systemctl reload nginx
ot_user ALL=(ALL) NOPASSWD: /usr/sbin/nginx -t
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–¥–µ–ø–ª–æ—è

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Å—Ç–æ —Å–¥–µ–ª–∞–π—Ç–µ push –≤ main:
```bash
git add .
git commit -m "Test auto-deploy"
git push origin main
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ **Actions** –Ω–∞ GitHub.

---

## üõ†Ô∏è –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å –≤—Ä—É—á–Ω—É—é, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `deploy.sh`:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /var/www/ot_online
bash deploy.sh
```

–ò–ª–∏ –ø–æ —à–∞–≥–∞–º:
```bash
# 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
git pull origin main

# 2. –ê–∫—Ç–∏–≤–∞—Ü–∏—è venv
source venv/bin/activate

# 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# 4. –ú–∏–≥—Ä–∞—Ü–∏–∏
python manage.py migrate

# 5. –°–±–æ—Ä–∫–∞ —Å—Ç–∞—Ç–∏–∫–∏
python manage.py collectstatic --noinput

# 6. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
sudo systemctl restart ot_online
sudo systemctl reload nginx
```

---

## üåê –î–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ CWP (Apache + Nginx)

–ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ **Control Web Panel (CWP)**, –º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —Ä–∞–±–æ—á—É—é —Å—Ö–µ–º—É —Å–∞–π—Ç–∞ `proverka.by`: Gunicorn —Å–ª—É—à–∞–µ—Ç –Ω–∞ `127.0.0.1`, –∞ Apache+Nginx –∏–∑ –ø–∞–Ω–µ–ª–∏ –ø—Ä–æ–∫—Å–∏—Ä—É—é—Ç —Ç—Ä–∞—Ñ–∏–∫ –∏ —Ä–∞–∑–¥–∞—é—Ç `/static`/`/media`. –ü–æ–ª–Ω–æ–µ –ø–æ—à–∞–≥–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—ã–Ω–µ—Å–µ–Ω–æ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç ‚Äî [docs/CWP_DEPLOYMENT.md](docs/CWP_DEPLOYMENT.md).

–í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã:

- `deploy/cwp/gunicorn-potby.service` ‚Äî –≥–æ—Ç–æ–≤—ã–π systemd‚Äë—é–Ω–∏—Ç (–∫–æ–ø–∏—Ä—É–µ–º –≤ `/etc/systemd/system/potby.service`).
- `deploy/cwp/gunicorn_start.sh` ‚Äî –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `.env` –∏ –ø–∏—à–µ—Ç –ª–æ–≥–∏ –≤ `logs/`).
- `deploy/cwp/apache-potby.conf` / `deploy/cwp/nginx-potby.conf` ‚Äî —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤ Apache/Nginx –≤ CWP (–∏–¥–µ–Ω—Ç–∏—á–Ω—ã —Ä–∞–±–æ—á–µ–º—É `proverka.by`).

–û—Å—Ç–∞—ë—Ç—Å—è:

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å gunicorn-—Å–ª—É–∂–±—É (`systemctl enable --now potby`).
2. –í CWP –¥–æ–±–∞–≤–∏—Ç—å alias `/static` –∏ `/media` –Ω–∞ `/home/django/webapps/potby/static`/`media`.
3. –ü—Ä–æ–ø–∏—Å–∞—Ç—å `ProxyPass` –Ω–∞ `127.0.0.1:8020` ‚Äî –∫–∞–∫ —Å–¥–µ–ª–∞–Ω–æ –Ω–∞ `proverka.by`.
4. –í—ã–ø—É—Å—Ç–∏—Ç—å SSL —á–µ—Ä–µ–∑ Let‚Äôs Encrypt –∏ –æ–±–Ω–æ–≤–∏—Ç—å `CSRF_TRUSTED_ORIGINS`.

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ —á–µ—Ä–µ–∑ –¥–æ–º–µ–Ω `pot.by`.

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –º–∏–≥—Ä–∞—Ü–∏–∏

### –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

–ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ:
```bash
py manage.py makemigrations --name describe_migration
py manage.py migrate
git add directory/migrations/
git commit -m "Add migration: describe_migration"
git push
```

### –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (–≤ —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º):
```bash
cd /var/www/ot_online
source venv/bin/activate
python manage.py migrate directory 0035  # –û—Ç–∫–∞—Ç –∫ –≤–µ—Ä—Å–∏–∏ 0035
sudo systemctl restart ot_online
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# –õ–æ–≥–∏ Gunicorn
sudo journalctl -u ot_online -f

# –õ–æ–≥–∏ Nginx
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log

# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
sudo tail -f /var/log/ot_online/access.log
sudo tail -f /var/log/ot_online/error.log
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–ª—É–∂–±

```bash
# –°—Ç–∞—Ç—É—Å Django –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
sudo systemctl status ot_online

# –°—Ç–∞—Ç—É—Å Nginx
sudo systemctl status nginx

# –°—Ç–∞—Ç—É—Å PostgreSQL
sudo systemctl status postgresql
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –∏ CPU
htop

# –†–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
sudo -u postgres psql -c "SELECT pg_size_pretty(pg_database_size('ot_online'));"

# –ú–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
df -h
```

---

## üíæ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `/home/ot_user/backup_db.sh`:
```bash
#!/bin/bash
DATE=$(date +"%Y%m%d_%H%M%S")
BACKUP_DIR="/var/backups/ot_online"
mkdir -p $BACKUP_DIR

# –ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
pg_dump -U ot_user ot_online | gzip > $BACKUP_DIR/db_$DATE.sql.gz

# –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤ (—Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π)
find $BACKUP_DIR -name "db_*.sql.gz" -mtime +7 -delete

echo "Backup completed: db_$DATE.sql.gz"
```

–î–æ–±–∞–≤—å—Ç–µ –≤ cron (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00):
```bash
crontab -e
```
```
0 3 * * * /home/ot_user/backup_db.sh >> /var/log/ot_online_backup.log 2>&1
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
sudo systemctl stop ot_online

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î
gunzip < /var/backups/ot_online/db_20250101_030000.sql.gz | sudo -u postgres psql ot_online

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
sudo systemctl start ot_online
```

---

## üîç –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "502 Bad Gateway"

**–ü—Ä–∏—á–∏–Ω–∞**: Gunicorn –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ —Å–æ–∫–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.

**–†–µ—à–µ–Ω–∏–µ**:
```bash
sudo systemctl status ot_online
sudo journalctl -u ot_online -n 50
sudo systemctl restart ot_online
```

### –û—à–∏–±–∫–∞: "Database connection failed"

**–ü—Ä–∏—á–∏–Ω–∞**: PostgreSQL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–µ —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

**–†–µ—à–µ–Ω–∏–µ**:
```bash
sudo systemctl status postgresql
sudo -u postgres psql -l  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ë–î
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª
```

### –û—à–∏–±–∫–∞: "Static files not found (404)"

**–ü—Ä–∏—á–∏–Ω–∞**: –°—Ç–∞—Ç–∏–∫–∞ –Ω–µ —Å–æ–±—Ä–∞–Ω–∞ –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π –ø—É—Ç—å –≤ Nginx.

**–†–µ—à–µ–Ω–∏–µ**:
```bash
cd /var/www/ot_online
source venv/bin/activate
python manage.py collectstatic --noinput
sudo nginx -t && sudo systemctl reload nginx
```

### GitHub Actions –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –ø–æ SSH

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–≤–µ—Ä–Ω—ã–π SSH –∫–ª—é—á –∏–ª–∏ firewall –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.

**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
cat ~/.ssh/authorized_keys | grep github-actions

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall
sudo ufw status
sudo ufw allow 22/tcp  # –ï—Å–ª–∏ –ø–æ—Ä—Ç SSH –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ (—Å–º. —Ä–∞–∑–¥–µ–ª "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏")
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–ª—É–∂–±
3. –°–æ–∑–¥–∞–π—Ç–µ Issue –≤ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã –∏ –ª–æ–≥–∞–º–∏

---

## üìù –ß–µ–∫–ª–∏—Å—Ç –¥–µ–ø–ª–æ—è

- [ ] –°–µ—Ä–≤–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–Ω (PostgreSQL, Nginx, Python)
- [ ] –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω
- [ ] –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ
- [ ] –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] `.env` —Ñ–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- [ ] –°—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω
- [ ] Gunicorn —Å–ª—É–∂–±–∞ –∑–∞–ø—É—â–µ–Ω–∞
- [ ] Nginx –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ–ª—É—á–µ–Ω
- [ ] GitHub Secrets –¥–æ–±–∞–≤–ª–µ–Ω—ã
- [ ] –ê–≤—Ç–æ–¥–µ–ø–ª–æ–π –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- [ ] –ë—ç–∫–∞–ø—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

---

**–£–¥–∞—á–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è! üöÄ**
