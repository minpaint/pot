# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã DEBUG —Ä–µ–∂–∏–º–∞ –≤ production

## üö® –ü—Ä–æ–±–ª–µ–º–∞

–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ 404 –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∞—Å—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è Django:

```python
{'tried': [[<URLPattern '' [name='home']>],
           [<URLResolver <URLPattern list> (admin:admin) 'admin/'>],
           ...],
 'path': 'yandex_e29c8fbc01012d21.html'}
```

**–≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ `DEBUG=True`!**

### –ü–æ—á–µ–º—É —ç—Ç–æ –æ–ø–∞—Å–Ω–æ?

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ 404 —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç:
- ‚úó **–°—Ç—Ä—É–∫—Ç—É—Ä—É URL** - –≥–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è admin, API endpoints
- ‚úó **–ü—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º** - —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ (`/home/django/webapps/potby/...`)
- ‚úó **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã** - —Å–ø–∏—Å–æ–∫ middleware, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- ‚úó **–í–µ—Ä—Å–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫** - –≤ traceback –≤–∏–¥–Ω—ã –ø—É—Ç–∏ –∫ site-packages
- ‚úó **–í–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É** - –∫–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω –ø—Ä–æ–µ–∫—Ç

**–≠—Ç–æ –¥–∞—ë—Ç –∞—Ç–∞–∫—É—é—â–∏–º –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è!** üéØ

## üîç –ü—Ä–∏—á–∏–Ω–∞

1. **Gunicorn –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π settings module**
   - –ë—ã–ª–æ: `DJANGO_SETTINGS_MODULE=settings`
   - –î–æ–ª–∂–Ω–æ: `DJANGO_SETTINGS_MODULE=settings_prod`

2. **–í settings.py DEBUG —á–∏—Ç–∞–ª—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è**
   ```python
   DEBUG = os.getenv('DJANGO_DEBUG', 'False') == 'True'
   ```
   –ü—Ä–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–≥ –±—ã—Ç—å –≤–∫–ª—é—á—ë–Ω.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ñ—ë—Å—Ç–∫–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ DEBUG –≤ settings.py

**–ò–∑–º–µ–Ω–µ–Ω–æ:**
```python
# settings.py (—Å—Ç—Ä–æ–∫–∞ 24)
# –ë–´–õ–û:
DEBUG = os.getenv('DJANGO_DEBUG', 'False') == 'True' and not TESTING

# –°–¢–ê–õ–û:
DEBUG = False  # –ö–†–ò–¢–ò–ß–ù–û: DEBUG –≤—Å–µ–≥–¥–∞ False –≤ production!
```

–¢–µ–ø–µ—Ä—å –¥–∞–∂–µ –µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç `DJANGO_DEBUG=True` –≤ `.env`, —ç—Ç–æ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç.

### 2. –°–æ–∑–¥–∞–Ω settings_dev.py –¥–ª—è development

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–∑–¥–∞–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª:
```python
# settings_dev.py
from settings import *

DEBUG = True  # –í–∫–ª—é—á–µ–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è dev
ALLOWED_HOSTS = ['*']
# ... development –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
# Development
export DJANGO_SETTINGS_MODULE=settings_dev
python manage.py runserver

# Production (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
export DJANGO_SETTINGS_MODULE=settings_prod
```

### 3. –°–∫—Ä–∏–ø—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Gunicorn

–°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π DEBUG:

**start_gunicorn.sh:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ DEBUG=False
- –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
- –ó–∞–ø—É—Å–∫–∞–µ—Ç —Å —è–≤–Ω—ã–º `DJANGO_SETTINGS_MODULE=settings_prod`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—É—Å–∫

**reload_gunicorn.sh:**
- Graceful reload –±–µ–∑ –¥–∞—É–Ω—Ç–∞–π–º–∞
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∏–≥–Ω–∞–ª HUP master –ø—Ä–æ—Ü–µ—Å—Å—É

**stop_gunicorn.sh:**
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö worker –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

### 4. –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**utility_scripts/check_debug_status.py:**
```bash
DJANGO_SETTINGS_MODULE=settings_prod venv/bin/python \
    utility_scripts/check_debug_status.py
```

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
- DEBUG —Ä–µ–∂–∏–º
- ALLOWED_HOSTS
- SECRET_KEY
- CSRF –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- Cookies –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- SSL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—à–∏–±–æ–∫

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DEBUG –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
```bash
cd /home/django/webapps/potby
DJANGO_SETTINGS_MODULE=settings_prod venv/bin/python -c \
    "from django.conf import settings; print('DEBUG =', settings.DEBUG)"
```
**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:** `DEBUG = False`

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É 404
```bash
curl -s https://pot.by/–Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ | grep -E "DOCTYPE|404"
```
**–î–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è:** –ö—Ä–∞—Å–∏–≤–∞—è –∫–∞—Å—Ç–æ–º–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ "404 - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"

**–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
- `{'tried': ...}`
- `<URLPattern ...>`
- –ü—É—Ç–µ–π –∫ —Ñ–∞–π–ª–∞–º –ø—Ä–æ–µ–∫—Ç–∞

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø—É—â–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å
```bash
ps aux | grep "[g]unicorn.*potby"
```
Worker –ø—Ä–æ—Ü–µ—Å—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞–∫—Ç–∏–≤–Ω—ã.

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
```bash
DJANGO_SETTINGS_MODULE=settings_prod venv/bin/python \
    utility_scripts/check_debug_status.py
```
**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:** `‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ –ø–æ—Ä—è–¥–∫–µ`

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ production —Å–µ—Ä–≤–µ—Ä–∞
```bash
cd /home/django/webapps/potby
./start_gunicorn.sh
```

### –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
```bash
./reload_gunicorn.sh
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
```bash
./stop_gunicorn.sh
```

### –î–µ–ø–ª–æ–π –∏–∑–º–µ–Ω–µ–Ω–∏–π
```bash
cd /home/django/webapps/potby
git pull
source venv/bin/activate
pip install -r requirements.txt
python manage.py migrate --settings=settings_prod
python manage.py collectstatic --noinput --settings=settings_prod
./reload_gunicorn.sh
```

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

- [x] DEBUG –∂—ë—Å—Ç–∫–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ False –≤ settings.py
- [x] settings_prod.py –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç DEBUG = False
- [x] –°–æ–∑–¥–∞–Ω settings_dev.py –¥–ª—è development
- [x] Gunicorn –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- [x] –°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π DEBUG
- [x] –°—Ç—Ä–∞–Ω–∏—Ü–∞ 404 –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Å—Ç–æ–º–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
- [x] –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞

**–£—Ä–æ–≤–Ω–∏ –∑–∞—â–∏—Ç—ã:**

1. **settings.py:** `DEBUG = False` (–∂—ë—Å—Ç–∫–æ)
2. **settings_prod.py:** `DEBUG = False` (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)
3. **start_gunicorn.sh:** –ü—Ä–æ–≤–µ—Ä–∫–∞ DEBUG –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
4. **check_debug_status.py:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–¢–µ–ø–µ—Ä—å **–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ** —Å–ª—É—á–∞–π–Ω–æ –≤–∫–ª—é—á–∏—Ç—å DEBUG –≤ production!

## üìù –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|-----------|
| `settings.py` | DEBUG = False (–∂—ë—Å—Ç–∫–æ) |
| `settings_prod.py` | –£–∂–µ –±—ã–ª–æ DEBUG = False |
| `settings_dev.py` | –ù–æ–≤—ã–π —Ñ–∞–π–ª –¥–ª—è development |
| `start_gunicorn.sh` | –ù–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ |
| `reload_gunicorn.sh` | –ù–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ |
| `stop_gunicorn.sh` | –ù–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ |
| `utility_scripts/check_debug_status.py` | –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ |
| `docs/DEBUG_MODE_FIX.md` | –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è |
| `docs/CWP_ARCHITECTURE.md` | –û–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã |

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

1. **–ù–ò–ö–û–ì–î–ê –Ω–µ –≤–∫–ª—é—á–∞–π—Ç–µ DEBUG –≤ production!**
   - –†–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º
   - –ú–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å SECRET_KEY –≤ traceback
   - –ó–∞–º–µ–¥–ª—è–µ—Ç —Ä–∞–±–æ—Ç—É (—Ö—Ä–∞–Ω–∏—Ç –≤—Å–µ SQL –∑–∞–ø—Ä–æ—Å—ã –≤ –ø–∞–º—è—Ç–∏)

2. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ start_gunicorn.sh**
   - –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç DEBUG –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
   - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã

3. **–î–ª—è development –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ settings_dev.py**
   ```bash
   export DJANGO_SETTINGS_MODULE=settings_dev
   python manage.py runserver
   ```

4. **–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
   ```bash
   ./utility_scripts/check_debug_status.py
   ```

## üìö –°–º. —Ç–∞–∫–∂–µ

- [CWP_ARCHITECTURE.md](CWP_ARCHITECTURE.md) - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è
- [SECURITY_GUIDE.md](SECURITY_GUIDE.md) - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [DEPLOYMENT.md](DEPLOYMENT.md) - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é

## üéØ –ò—Ç–æ–≥

**–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞!** Django –≤ production —Ç–µ–ø–µ—Ä—å:
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å DEBUG=False
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫—Ä–∞—Å–∏–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—à–∏–±–æ–∫
- ‚úÖ –ù–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- ‚úÖ –ó–∞—â–∏—â—ë–Ω –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—Ä–æ–≤–Ω—è—Ö
- ‚úÖ –ò–º–µ–µ—Ç —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ 404 –±–æ–ª—å—à–µ –Ω–µ –ø–æ—è–≤–∏—Ç—Å—è!** üéâ
