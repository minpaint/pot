# Переменные для DOCX-шаблонов документов

## Комиссия по проверке знаний

Все переменные автоматически заполняются данными из комиссии, назначенной для сотрудника (по иерархии: отдел → подразделение → организация).

### Председатель комиссии

- `{{ chairman_role_label }}` — текст "Председатель комиссии:" (если председатель назначен) или пустая строка
- `{{ chairman_name }}` — ФИО председателя или пустая строка
- `{{ chairman_position }}` — должность председателя строчными буквами или пустая строка
- `{{ chairman_name_initials }}` — инициалы председателя (формат "И.О. Фамилия") или пустая строка

### Заместитель председателя комиссии

- `{{ vice_chairman_role_label }}` — текст "Заместитель председателя комиссии:" (если заместитель назначен) или пустая строка
- `{{ vice_chairman_name }}` — ФИО заместителя или пустая строка
- `{{ vice_chairman_position }}` — должность заместителя строчными буквами или пустая строка
- `{{ vice_chairman_name_initials }}` — инициалы заместителя (формат "И.О. Фамилия") или пустая строка

### Секретарь комиссии

- `{{ secretary_role_label }}` — текст "Секретарь комиссии:" (если секретарь назначен) или пустая строка
- `{{ secretary_name }}` — ФИО секретаря или пустая строка
- `{{ secretary_position }}` — должность секретаря строчными буквами или пустая строка
- `{{ secretary_name_initials }}` — инициалы секретаря (формат "И.О. Фамилия") или пустая строка

## Примеры использования в DOCX-шаблонах

### Вариант 1: С динамическими заголовками ролей (рекомендуется)

```
{{ chairman_role_label }} {{ chairman_name }} - {{ chairman_position }}
{{ vice_chairman_role_label }} {{ vice_chairman_name }} - {{ vice_chairman_position }}
{{ secretary_role_label }} {{ secretary_name }} - {{ secretary_position }}
```

**Результат:**
- Если роль **заполнена**: `Заместитель председателя комиссии: Мингинович Александр Георгиевич - начальник сектора`
- Если роль **НЕ заполнена**: пустая строка (строка вообще не выводится в документе)

### Вариант 2: Со статическими заголовками (не рекомендуется)

```
Председатель комиссии: {{ chairman_name }} - {{ chairman_position }}
Заместитель председателя: {{ vice_chairman_name }} - {{ vice_chairman_position }}
Секретарь комиссии: {{ secretary_name }} - {{ secretary_position }}
```

**Проблема:** Если роль не заполнена, заголовок останется, но имя и должность будут пустыми:
```
Председатель комиссии:  -
Заместитель председателя:  -     ← Пустая строка с заголовком!
Секретарь комиссии: Обухович Наталья Анатольевна - ведущий инженер
```

### Вариант 3: Только инициалы (для удостоверений)

```
Председатель комиссии: {{ chairman_name_initials }}
Заместитель председателя комиссии: {{ vice_chairman_name_initials }}
```

**Результат:**
- Если роль **заполнена**: `Заместитель председателя комиссии: А.Г. Мингинович`
- Если роль **НЕ заполнена**: `Заместитель председателя комиссии: ` (пустое поле после заголовка)

**Рекомендация:** Используйте `{{ vice_chairman_role_label }} {{ vice_chairman_name_initials }}` для автоматического скрытия всей строки.

## Члены комиссии

Для вывода списка членов комиссии (все, кроме председателя, заместителя и секретаря):

### Параграфы с ФИО и должностями

```
{% for member in members_paragraphs %}
{{ member }}
{% endfor %}
```

**Результат:**
```
Иванов Иван Иванович - главный специалист
Петрова Мария Сергеевна - инженер по охране труда
```

### Параграфы с инициалами

```
{% for initials in members_initials_paragraphs %}
{{ initials }}
{% endfor %}
```

**Результат:**
```
И.И. Иванов
М.С. Петрова
```

## Полный пример протокола

```docx
ПРОТОКОЛ
проверки знаний по охране труда

{{ protocol_date }}

{{ chairman_role_label }} {{ chairman_name }} - {{ chairman_position }}
{{ vice_chairman_role_label }} {{ vice_chairman_name }} - {{ vice_chairman_position }}
{{ secretary_role_label }} {{ secretary_name }} - {{ secretary_position }}

Члены комиссии:
{% for member in members_paragraphs %}
{{ member }}
{% endfor %}

Проверку проходил: {{ employee_name }}
Должность: {{ position_nominative }}

Решение комиссии: Допущен к самостоятельной работе

Председатель комиссии: {{ chairman_name_initials }} __________
{{ vice_chairman_role_label }} {{ vice_chairman_name_initials }} __________
Секретарь комиссии: {{ secretary_name_initials }} __________
```

## Важные замечания

1. **Пустые строки:** Если роль не заполнена (например, нет заместителя председателя), все переменные для этой роли будут **пустыми строками**, а не тире или прочерками.

2. **Автоматическое скрытие:** Используйте переменные `*_role_label` для автоматического скрытия целых строк, когда роль не назначена.

3. **Автоматическая очистка документов:** После генерации документа система **автоматически удаляет пустые параграфы** и строки таблиц из всех частей документа (body, headers, footers). Это означает:
   - Если в шаблоне есть строка `{{ vice_chairman_role_label }} {{ vice_chairman_name }}` и все переменные пустые, строка будет полностью удалена из итогового документа
   - Параграфы, содержащие только пробелы, тире (`-`, `—`, `–`) или пустые, также удаляются
   - Очистка работает в основном содержимом (body), заголовках (headers) и футерах (footers)
   - Это работает для всех протоколов и удостоверений автоматически — ничего дополнительно настраивать не нужно

   **Сохранение пустых параграфов для форматирования:**
   - Если нужно оставить пустой параграф (для отступов, разрывов), добавьте маркер `{# keep_empty #}` в параграф
   - После генерации маркер будет удалён, но параграф останется пустым
   - Пример в шаблоне: создайте пустой параграф и напишите в нём `{# keep_empty #}`
   - В итоговом документе будет пустой параграф без маркера

4. **Регистр должностей:** Все переменные `*_position` автоматически приводятся к нижнему регистру для соответствия правилам русского языка в протоколах.

5. **Формат инициалов:** Инициалы всегда идут перед фамилией: "И.О. Фамилия" (например, "И.Р. Фаттахов").

6. **Иерархия комиссий:** Система автоматически ищет комиссию для сотрудника по иерархии:
   - Сначала на уровне отдела
   - Если нет — на уровне подразделения
   - Если нет — на уровне организации

## Доступность переменных

### Протоколы проверки знаний (первичные)
✅ Все переменные доступны

### Протоколы проверки знаний (периодические)
✅ Все переменные доступны

### Удостоверения по охране труда
✅ Доступны только переменные с инициалами:
- `chairman_name_initials`
- `vice_chairman_name_initials`
- `secretary_name_initials`

### Прочие документы
⚠️ Переменные могут быть недоступны или неполными. Проверяйте в каждом конкретном генераторе документов.
