# üìß –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä—ë—Ö—É—Ä–æ–≤–Ω–µ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã —Å–±–æ—Ä–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π email

**–î–∞—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** 04.12.2025
**–í–µ—Ä—Å–∏—è:** 1.0
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ](#—á—Ç–æ-—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
3. [–ù–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –∏ –ø–æ–ª—è](#–Ω–æ–≤—ã–µ-–º–æ–¥–µ–ª–∏-–∏-–ø–æ–ª—è)
4. [–£—Ç–∏–ª–∏—Ç—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏](#—É—Ç–∏–ª–∏—Ç—ã-–∏-—Ñ—É–Ω–∫—Ü–∏–∏)
5. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-–≤-—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π-–∫–æ–¥)
6. [–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ](#–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è-–ø–æ-–Ω–∞—Å—Ç—Ä–æ–π–∫–µ)
7. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
8. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
9. [–ú–∏–≥—Ä–∞—Ü–∏–∏](#–º–∏–≥—Ä–∞—Ü–∏–∏)

---

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è —Ç—Ä—ë—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π email:

1. **SubdivisionEmail** ‚Äî Email –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π (–Ω–æ–≤–∞—è –º–æ–¥–µ–ª—å)
2. **Employee.email** ‚Äî Email –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞ –æ—Ö—Ä–∞–Ω—É —Ç—Ä—É–¥–∞ (–Ω–æ–≤–æ–µ –ø–æ–ª–µ)
3. **EmailSettings.recipient_emails** ‚Äî –û–±—â–∏–µ email –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –º–æ–¥–µ–ª—å)

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

- ‚úÖ –í—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ** (–±–µ–∑ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ **—É–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤** —á–µ—Ä–µ–∑ Python `set()`
- ‚úÖ **Fail-safe –ø–æ–¥—Ö–æ–¥** ‚Äî –µ—Å–ª–∏ –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ—Å—Ç–∞–ª—å–Ω—ã–µ
- ‚úÖ **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ —Å–±–æ—Ä–∞
- ‚úÖ **–ì–∏–±–∫–∏–µ —Ñ–ª–∞–≥–∏** –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- ‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ            –¢–†–Å–•–£–†–û–í–ù–ï–í–ê–Ø –°–ò–°–¢–ï–ú–ê –°–ë–û–†–ê –ü–û–õ–£–ß–ê–¢–ï–õ–ï–ô          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚ñº                 ‚ñº                 ‚ñº
   –ò–°–¢–û–ß–ù–ò–ö 1        –ò–°–¢–û–ß–ù–ò–ö 2        –ò–°–¢–û–ß–ù–ò–ö 3
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇSubdivisionE- ‚îÇ  ‚îÇEmployee.email‚îÇ  ‚îÇEmailSettings ‚îÇ
‚îÇmail          ‚îÇ  ‚îÇ(–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω.  ‚îÇ  ‚îÇ.recipient_   ‚îÇ
‚îÇ(–ù–û–í–ê–Ø)       ‚îÇ  ‚îÇ –∑–∞ –û–¢)       ‚îÇ  ‚îÇemails        ‚îÇ
‚îÇ              ‚îÇ  ‚îÇ(–ù–û–í–û–ï –ü–û–õ–ï)  ‚îÇ  ‚îÇ(—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îÇ                 ‚îÇ                 ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚ñº
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ  set() –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç‚îÇ
              ‚îÇ  –±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤  ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                        ‚ñº
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ –ò—Ç–æ–≥–æ–≤—ã–π —Å–ø–∏—Å–æ–∫  ‚îÇ
              ‚îÇ   –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π    ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üÜï –ù–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –∏ –ø–æ–ª—è

### 1. –ú–æ–¥–µ–ª—å `SubdivisionEmail`

**–§–∞–π–ª:** `directory/models/subdivision_email.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–∏—Ç email-–∞–¥—Ä–µ—Å–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è.

**–ü–æ–ª—è:**
- `subdivision` ‚Äî ForeignKey –Ω–∞ StructuralSubdivision
- `email` ‚Äî EmailField (email-–∞–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è)
- `description` ‚Äî CharField (–æ–ø–∏—Å–∞–Ω–∏–µ —Ä–æ–ª–∏: "–ì–ª–∞–≤–Ω—ã–π –∏–Ω–∂–µ–Ω–µ—Ä", "–ú–∞—Å—Ç–µ—Ä" –∏ —Ç.–¥.)
- `is_active` ‚Äî BooleanField (–∞–∫—Ç–∏–≤–µ–Ω –ª–∏ –∞–¥—Ä–µ—Å)
- `created_at` ‚Äî DateTimeField (–¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è)
- `updated_at` ‚Äî DateTimeField (–¥–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è)

**–°–≤—è–∑—å:** `subdivision.notification_emails` (related_name)

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```python
from directory.models import StructuralSubdivision, SubdivisionEmail

subdivision = StructuralSubdivision.objects.get(name="–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π —Ü–µ—Ö")

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ email
SubdivisionEmail.objects.create(
    subdivision=subdivision,
    email="engineer@company.com",
    description="–ì–ª–∞–≤–Ω—ã–π –∏–Ω–∂–µ–Ω–µ—Ä",
    is_active=True
)

# –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö email
emails = subdivision.notification_emails.filter(is_active=True)
```

---

### 2. –ü–æ–ª–µ `Employee.email`

**–§–∞–π–ª:** `directory/models/employee.py`

**–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ:**
```python
email = models.EmailField(
    verbose_name="Email",
    blank=True,
    default='',
    help_text="Email —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π "
              "(–æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ –¥–ª—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞ –æ—Ö—Ä–∞–Ω—É —Ç—Ä—É–¥–∞)"
)
```

**–ì–¥–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:**
- –í —Å–ø–∏—Å–∫–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ (list_display)
- –í —Ñ–æ—Ä–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
- –í –∞–¥–º–∏–Ω–∫–µ Employee

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å –¥–æ–ª–∂–Ω–æ—Å—Ç—å—é `position.is_responsible_for_safety=True` –∏ —Å–æ–±–∏—Ä–∞–µ—Ç –∏—Ö email.

---

## üõ†Ô∏è –£—Ç–∏–ª–∏—Ç—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏

### –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: `collect_recipients_for_subdivision()`

**–§–∞–π–ª:** `directory/utils/email_recipients.py`

**–°–∏–≥–Ω–∞—Ç—É—Ä–∞:**
```python
def collect_recipients_for_subdivision(
    subdivision: Optional[StructuralSubdivision],
    organization: Organization,
    include_subdivision_emails: bool = True,
    include_responsible_employees: bool = True,
    include_organization_emails: bool = True
) -> List[str]:
    """
    –°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ—Ö –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π email –¥–ª—è –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∏–∑ —Ç—Ä—ë—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.

    Args:
        subdivision: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ (–º–æ–∂–µ—Ç –±—ã—Ç—å None)
        organization: –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
        include_subdivision_emails: –í–∫–ª—é—á–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ 1
        include_responsible_employees: –í–∫–ª—é—á–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ 2
        include_organization_emails: –í–∫–ª—é—á–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ 3

    Returns:
        list[str]: –°–ø–∏—Å–æ–∫ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö email-–∞–¥—Ä–µ—Å–æ–≤
    """
```

**–ü—Ä–∏–º–µ—Ä—ã:**

```python
from directory.models import StructuralSubdivision, Organization
from directory.utils.email_recipients import collect_recipients_for_subdivision

# –ü—Ä–∏–º–µ—Ä 1: –°–±–æ—Ä –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
subdivision = StructuralSubdivision.objects.get(name="–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π —Ü–µ—Ö")
organization = subdivision.organization

recipients = collect_recipients_for_subdivision(subdivision, organization)
# –†–µ–∑—É–ª—å—Ç–∞—Ç: ['engineer@company.com', 'ivanov@company.com', 'hr@company.com']

# –ü—Ä–∏–º–µ—Ä 2: –¢–æ–ª—å–∫–æ email –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (subdivision=None)
recipients = collect_recipients_for_subdivision(None, organization)
# –†–µ–∑—É–ª—å—Ç–∞—Ç: ['hr@company.com', 'director@company.com']

# –ü—Ä–∏–º–µ—Ä 3: –¢–æ–ª—å–∫–æ SubdivisionEmail (–æ—Ç–∫–ª—é—á–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏)
recipients = collect_recipients_for_subdivision(
    subdivision,
    organization,
    include_subdivision_emails=True,
    include_responsible_employees=False,
    include_organization_emails=False
)
```

---

### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: `get_recipients_summary()`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–∞–∂–¥–æ–º—É –∏—Å—Ç–æ—á–Ω–∏–∫—É.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
from directory.utils.email_recipients import get_recipients_summary

summary = get_recipients_summary(subdivision, organization)

print(f"–ò—Å—Ç–æ—á–Ω–∏–∫ 1 (SubdivisionEmail): {len(summary['subdivision_emails'])}")
print(f"–ò—Å—Ç–æ—á–Ω–∏–∫ 2 (–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞ –û–¢): {len(summary['responsible_employees'])}")
print(f"–ò—Å—Ç–æ—á–Ω–∏–∫ 3 (EmailSettings): {len(summary['organization_emails'])}")
print(f"–î—É–±–ª–∏–∫–∞—Ç–æ–≤ —É–¥–∞–ª–µ–Ω–æ: {summary['duplicates_removed']}")
print(f"–ò—Ç–æ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö: {summary['total']}")
```

---

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥

### –ö–æ–º–∞–Ω–¥–∞ `send_medical_notifications`

**–§–∞–π–ª:** `deadline_control/management/commands/send_medical_notifications.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```python
# –°–¢–ê–†–´–ô –ö–û–î (–¥–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏):
recipient_list = email_settings.get_recipient_list()
if not recipient_list:
    recipient_list = list(User.objects.filter(is_staff=True, ...).values_list('email', flat=True))

# –ù–û–í–´–ô –ö–û–î (–ø–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏):
from directory.utils.email_recipients import collect_recipients_for_subdivision

recipient_list = collect_recipients_for_subdivision(
    subdivision=None,  # –î–ª—è –∫–æ–º–∞–Ω–¥—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É—Ä–æ–≤–µ–Ω—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
    organization=organization
)

# Fallback –Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤, –µ—Å–ª–∏ –≤–æ–æ–±—â–µ –Ω–∏–∫–æ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
if not recipient_list:
    recipient_list = list(User.objects.filter(is_staff=True, ...).values_list('email', flat=True))
```

**–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Ä–∞–Ω—å—à–µ, –Ω–æ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É.

---

## üìö –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ EmailSettings (–∏—Å—Ç–æ—á–Ω–∏–∫ 3)

**–ü—É—Ç—å:** –ê–¥–º–∏–Ω–∫–∞ ‚Üí Deadline Control ‚Üí Email Settings (SMTP)

1. –í—ã–±–µ—Ä–∏—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SMTP –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (host, port, user, password)
3. –í –ø–æ–ª–µ **"Email –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π"** —É–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å–∞ (–∫–∞–∂–¥—ã–π —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏):
   ```
   hr@company.com
   director@company.com
   safety@company.com
   ```
4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≥–∞–ª–æ—á–∫—É **"–ê–∫—Ç–∏–≤–Ω–æ"**
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –≠—Ç–∏ –∞–¥—Ä–µ—Å–∞ –±—É–¥—É—Ç –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –≤—Å–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.

---

### –®–∞–≥ 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ email –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è (–∏—Å—Ç–æ—á–Ω–∏–∫ 1)

**–ü—É—Ç—å:** –ê–¥–º–∏–Ω–∫–∞ ‚Üí –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ ‚Üí –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è ‚Üí –í—ã–±—Ä–∞—Ç—å –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω—É–∂–Ω–æ–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ
2. –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –≤–Ω–∏–∑ –¥–æ —Å–µ–∫—Ü–∏–∏ **"Email –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"**
3. –î–æ–±–∞–≤—å—Ç–µ email:
   - **Email:** `engineer@company.com`
   - **–û–ø–∏—Å–∞–Ω–∏–µ:** "–ì–ª–∞–≤–Ω—ã–π –∏–Ω–∂–µ–Ω–µ—Ä"
   - **–ê–∫—Ç–∏–≤–µ–Ω:** ‚úì
4. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–¥—Ä–µ—Å–æ–≤ (–∫–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –µ—â—ë")
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –≠—Ç–∏ –∞–¥—Ä–µ—Å–∞ –±—É–¥—É—Ç –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è.

---

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ email –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞ –û–¢ (–∏—Å—Ç–æ—á–Ω–∏–∫ 2)

**3.1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏:**

**–ü—É—Ç—å:** –ê–¥–º–∏–Ω–∫–∞ ‚Üí –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ ‚Üí –î–æ–ª–∂–Ω–æ—Å—Ç–∏ ‚Üí –í—ã–±—Ä–∞—Ç—å –¥–æ–ª–∂–Ω–æ—Å—Ç—å

1. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ª–∂–Ω–æ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ò–Ω–∂–µ–Ω–µ—Ä –ø–æ –æ—Ö—Ä–∞–Ω–µ —Ç—Ä—É–¥–∞")
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≥–∞–ª–æ—á–∫—É **"–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞ –æ—Ö—Ä–∞–Ω—É —Ç—Ä—É–¥–∞"**
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

**3.2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ email —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É:**

**–ü—É—Ç—å:** –ê–¥–º–∏–Ω–∫–∞ ‚Üí –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ ‚Üí –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ ‚Üí –í—ã–±—Ä–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ —Å –¥–æ–ª–∂–Ω–æ—Å—Ç—å—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∑–∞ –û–¢
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–µ **"Email":** `ivanov@company.com`
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Email —ç—Ç–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á—ë–Ω –≤ —Ä–∞—Å—Å—ã–ª–∫–∏ –¥–ª—è –µ–≥–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è.

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–≤—Å–µ 3 –∏—Å—Ç–æ—á–Ω–∏–∫–∞)

**–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:** –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π —Ü–µ—Ö

| –ò—Å—Ç–æ—á–Ω–∏–∫ | Email –∞–¥—Ä–µ—Å–∞ |
|----------|--------------|
| 1Ô∏è‚É£ SubdivisionEmail | `engineer@company.com`, `foreman@company.com` |
| 2Ô∏è‚É£ –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞ –û–¢ | `ivanov@company.com` |
| 3Ô∏è‚É£ EmailSettings | `hr@company.com`, `director@company.com` |

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 5 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π

---

### –ü—Ä–∏–º–µ—Ä 2: –¢–æ–ª—å–∫–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è (–±–µ–∑ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è)

**–í—ã–∑–æ–≤:**
```python
recipients = collect_recipients_for_subdivision(None, organization)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ò—Å—Ç–æ—á–Ω–∏–∫ 1: ‚è≠Ô∏è –ø—Ä–æ–ø—É—â–µ–Ω (subdivision=None)
- –ò—Å—Ç–æ—á–Ω–∏–∫ 2: ‚è≠Ô∏è –ø—Ä–æ–ø—É—â–µ–Ω (subdivision=None)
- –ò—Å—Ç–æ—á–Ω–∏–∫ 3: ‚úÖ `['hr@company.com', 'director@company.com']`

---

### –ü—Ä–∏–º–µ—Ä 3: –° –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏

**–°–∏—Ç—É–∞—Ü–∏—è:**
- –ò—Å—Ç–æ—á–Ω–∏–∫ 1: `safety@company.com`
- –ò—Å—Ç–æ—á–Ω–∏–∫ 2: `safety@company.com` ‚Üê –¥—É–±–ª–∏–∫–∞—Ç
- –ò—Å—Ç–æ—á–Ω–∏–∫ 3: `hr@company.com`, `safety@company.com` ‚Üê –¥—É–±–ª–∏–∫–∞—Ç

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `['safety@company.com', 'hr@company.com']` (2 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∞–¥—Ä–µ—Å–∞)

–î—É–±–ª–∏–∫–∞—Ç –≤—Å—Ç—Ä–µ—á–∞–ª—Å—è 3 —Ä–∞–∑–∞, –Ω–æ –æ—Å—Ç–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ 1 —Ä–∞–∑ –±–ª–∞–≥–æ–¥–∞—Ä—è `set()`.

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

**–§–∞–π–ª:** `test_email_recipients.py`

**–ó–∞–ø—É—Å–∫:**
```bash
python test_email_recipients.py
```

**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç:**
1. –°–±–æ—Ä –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –Ω–∞ —É—Ä–æ–≤–Ω–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
2. –°–±–æ—Ä –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –¥–ª—è –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
3. –î–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
4. –†–∞–±–æ—Ç—É —Å —Ñ–ª–∞–≥–∞–º–∏ –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞:**
```
‚úÖ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û

–¢–ï–°–¢ 1: –°–±–æ—Ä –Ω–∞ —É—Ä–æ–≤–Ω–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
   –ù–∞–π–¥–µ–Ω–æ: 2 –ø–æ–ª—É—á–∞—Ç–µ–ª—è

–¢–ï–°–¢ 2: –°–±–æ—Ä –¥–ª—è –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
   –ò—Å—Ç–æ—á–Ω–∏–∫ 1 (SubdivisionEmail): 2 –∞–¥—Ä–µ—Å–∞
   –ò—Å—Ç–æ—á–Ω–∏–∫ 2 (–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞ –û–¢): 1 –∞–¥—Ä–µ—Å
   –ò—Å—Ç–æ—á–Ω–∏–∫ 3 (EmailSettings): 2 –∞–¥—Ä–µ—Å–∞
   –î—É–±–ª–∏–∫–∞—Ç–æ–≤ —É–¥–∞–ª–µ–Ω–æ: 1
   –ò—Ç–æ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö: 4
```

---

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–∞–Ω–¥—ã send_medical_notifications

**–¢–µ—Å—Ç 1: –°—É—Ö–æ–π –ø—Ä–æ–≥–æ–Ω (–±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏)**
```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
py manage.py send_medical_notifications --help
```

**–¢–µ—Å—Ç 2: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º email**
```bash
py manage.py send_medical_notifications --emails "test@example.com"
```

**–¢–µ—Å—Ç 3: –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏**
```bash
py manage.py send_medical_notifications --organization 1
```

---

## üóÉÔ∏è –ú–∏–≥—Ä–∞—Ü–∏–∏

### –ú–∏–≥—Ä–∞—Ü–∏—è: `0049_add_email_recipient_system.py`

**–°–æ–∑–¥–∞–Ω–∞:** 04.12.2025

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ `email` –≤ –º–æ–¥–µ–ª—å `Employee`
2. –°–æ–∑–¥–∞—ë—Ç –º–æ–¥–µ–ª—å `SubdivisionEmail`
3. –î–æ–±–∞–≤–ª—è–µ—Ç –∏–Ω–¥–µ–∫—Å—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
```bash
py manage.py migrate directory
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ

---

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ª–æ–≥–≥–µ—Ä Django:

```python
import logging
logger = logging.getLogger(__name__)
```

**–£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:**

| –£—Ä–æ–≤–µ–Ω—å | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | –ü—Ä–∏–º–µ—Ä |
|---------|-------------------|--------|
| `INFO` | –£—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ | `‚úÖ [–ò—Å—Ç–æ—á–Ω–∏–∫ 1] –ù–∞–π–¥–µ–Ω–æ 2 email` |
| `DEBUG` | –î–µ—Ç–∞–ª–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ | `–ê–¥—Ä–µ—Å–∞: engineer@company.com, ...` |
| `WARNING` | –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è | `‚ö†Ô∏è EmailSettings –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç` |
| `ERROR` | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ | `‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: ...` |

**–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:**
–õ–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–º–∞–Ω–¥—ã `send_medical_notifications`.

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –í–∞–ª–∏–¥–∞—Ü–∏—è email

- Django `EmailField` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç
- –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ë–î
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤ `_clean_email_list()`:
  - –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–æ–≤
  - –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
  - –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø—Ä–∞–≤–∞–º –¥–æ—Å—Ç—É–ø–∞

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `AccessControlHelper`:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `request.user.profile.organizations`

### –ò—Å–∫–ª—é—á–µ–Ω–∏—è

–ù–µ –≤–∫–ª—é—á–∞—é—Ç—Å—è –≤ —Ä–∞—Å—Å—ã–ª–∫—É:
- –ü—É—Å—Ç—ã–µ email (`''` –∏–ª–∏ `NULL`)
- –û—Ç–∫–ª—é—á–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ (`is_active=False`)
- –£–≤–æ–ª–µ–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ (`status='fired'`)
- –û—Ç–∫–ª—é—á–µ–Ω–Ω—ã–µ EmailSettings (`is_active=False`)

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ù–µ—Ç –Ω–æ–≤—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ SMTP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ `EmailSettings`.

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

- `include_subdivision_emails=True`
- `include_responsible_employees=True`
- `include_organization_emails=True`

### Fallback-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è

–ï—Å–ª–∏ –≤—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –ø—É—Å—Ç—ã–µ:
1. –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
2. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
3. –í—ã–∑—ã–≤–∞—é—â–∏–π –∫–æ–¥ —Ä–µ—à–∞–µ—Ç, —á—Ç–æ –¥–µ–ª–∞—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, fallback –Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤)

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**
–ó–∞–ø–æ–ª–Ω–∏—Ç–µ EmailSettings ‚Üí –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è –≤—Å–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

**–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**
- EmailSettings (–æ–±—â–∏–µ –∞–¥—Ä–µ—Å–∞)
- SubdivisionEmail (—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π)
- Employee.email –¥–ª—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞ –û–¢

**–ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**
–í—Å–µ —Ç—Ä–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ ‚Üí –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ

---

### –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

–î–ª—è –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

1. **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º** ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–∏—Å–µ–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
2. **–ò—Å—Ç–æ—Ä–∏—è –æ—Ç–ø—Ä–∞–≤–æ–∫** ‚Äî –º–æ–¥–µ–ª—å `MailingHistory` (—É–∂–µ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤ `INSTRUCTION_JOURNAL_MAILING.md`)
3. **–®–∞–±–ª–æ–Ω—ã –ø–∏—Å–µ–º** ‚Äî –º–æ–¥–µ–ª—å `EmailTemplate` —Å –∑–∞–≥–ª—É—à–∫–∞–º–∏
4. **UI –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** ‚Äî –∫–Ω–æ–ø–∫–∞ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π" –≤ –∞–¥–º–∏–Ω–∫–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
5. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** ‚Äî dashboard —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Django
py manage.py check

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π
py manage.py showmigrations directory

# 3. –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–∏ —Å–±–æ—Ä–∞
python test_email_recipients.py

# 4. –¢–µ—Å—Ç –∫–æ–º–∞–Ω–¥—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ (–±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏)
py manage.py send_medical_notifications --help
```

### –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ EmailSettings –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `is_active=True`
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ `recipient_emails` (–∫–∞–∂–¥—ã–π —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)

---

**–ü—Ä–æ–±–ª–µ–º–∞:** Email –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SMTP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ EmailSettings
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–¢–µ—Å—Ç email" –≤ –∞–¥–º–∏–Ω–∫–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏ SMTP

---

**–ü—Ä–æ–±–ª–µ–º–∞:** –î—É–±–ª–∏–∫–∞—Ç—ã –≤ —Å–ø–∏—Å–∫–µ

**–†–µ—à–µ–Ω–∏–µ:**
–≠—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ ‚Äî —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã —á–µ—Ä–µ–∑ `set()`.

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- [x] –ú–æ–¥–µ–ª—å `SubdivisionEmail` —Å–æ–∑–¥–∞–Ω–∞
- [x] –ü–æ–ª–µ `Employee.email` –¥–æ–±–∞–≤–ª–µ–Ω–æ
- [x] –£—Ç–∏–ª–∏—Ç–∞ `collect_recipients_for_subdivision()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- [x] –ê–¥–º–∏–Ω–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (inline –¥–ª—è SubdivisionEmail)
- [x] –ê–¥–º–∏–Ω–∫–∞ Employee –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (–ø–æ–ª–µ email)
- [x] –ú–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `send_medical_notifications` –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
- [x] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–æ
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- [x] –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

---

**–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0
**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 04.12.2025
**–ê–≤—Ç–æ—Ä:** Claude Code (Anthropic)
