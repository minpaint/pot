# üì® –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π email –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏ –∂—É—Ä–Ω–∞–ª–æ–≤ –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–µ–π

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–û–±—â–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è](#–æ–±—â–∞—è-–∫–æ–Ω—Ü–µ–ø—Ü–∏—è)
2. [–¢—Ä–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π](#—Ç—Ä–∏-–∏—Å—Ç–æ—á–Ω–∏–∫–∞-–ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π)
3. [–ê–ª–≥–æ—Ä–∏—Ç–º —Å–±–æ—Ä–∞](#–∞–ª–≥–æ—Ä–∏—Ç–º-—Å–±–æ—Ä–∞)
4. [–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏ –ø—Ä–∞–≤–∏–ª–∞](#–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã-–∏-–ø—Ä–∞–≤–∏–ª–∞)
5. [–ü—Ä–∏–º–µ—Ä—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤](#–ø—Ä–∏–º–µ—Ä—ã-—Å—Ü–µ–Ω–∞—Ä–∏–µ–≤)
6. [–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏](#–≥—Ä–∞–Ω–∏—á–Ω—ã–µ-—Å–ª—É—á–∞–∏)
7. [–ë–ª–æ–∫-—Å—Ö–µ–º–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∞](#–±–ª–æ–∫-—Å—Ö–µ–º–∞-–∞–ª–≥–æ—Ä–∏—Ç–º–∞)
8. [–ö–æ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏](#–∫–æ–¥-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)

---

## –û–±—â–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è

### –ó–∞–¥–∞—á–∞
–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Å–æ–±—Ä–∞—Ç—å —Å–ø–∏—Å–æ–∫ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö email-–∞–¥—Ä–µ—Å–æ–≤, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –æ–±—Ä–∞–∑–µ—Ü –∂—É—Ä–Ω–∞–ª–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–µ–π.

### –ü—Ä–∏–Ω—Ü–∏–ø
**–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥** ‚Äî –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –∏–∑ —Ç—Ä—ë—Ö –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:
1. üìß **Email –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è** ‚Äî —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
2. üëë **Email –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞ –û–¢** ‚Äî –∞–¥—Ä–µ—Å–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å –¥–æ–ª–∂–Ω–æ—Å—Ç—å—é "–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞ –æ—Ö—Ä–∞–Ω—É —Ç—Ä—É–¥–∞"
3. üè¢ **Email –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏** ‚Äî –æ–±—â–∏–µ –∞–¥—Ä–µ—Å–∞ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ EmailSettings

### –§–∏–ª–æ—Å–æ—Ñ–∏—è
- **–ù–µ –∏—Å–∫–ª—é—á–∞–µ–º, –∞ –¥–æ–ø–æ–ª–Ω—è–µ–º** ‚Äî –≤—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- **–ë–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∞–¥—Ä–µ—Å–æ–≤
- **Fail-safe** ‚Äî –µ—Å–ª–∏ –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ—Å—Ç–∞–ª—å–Ω—ã–µ
- **–ì–∏–±–∫–æ—Å—Ç—å** ‚Äî –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

---

## –¢—Ä–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π

### –ò—Å—Ç–æ—á–Ω–∏–∫ 1Ô∏è‚É£: Email –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è (SubdivisionEmail)

**–ß—Ç–æ —ç—Ç–æ:**
–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ email-–∞–¥—Ä–µ—Å–∞, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–º—É –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é —á–µ—Ä–µ–∑ inline-–º–æ–¥–µ–ª—å.

**–ú–æ–¥–µ–ª—å:**
```python
class SubdivisionEmail(models.Model):
    subdivision = ForeignKey(StructuralSubdivision)
    email = EmailField()
    description = CharField()  # "–ì–ª–∞–≤–Ω—ã–π –∏–Ω–∂–µ–Ω–µ—Ä", "–°–ª—É–∂–±–∞ –û–¢"
    is_active = BooleanField(default=True)
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- –ï—Å—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ (subdivision != None)
- –í –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã email (SubdivisionEmail.objects.filter(...).exists())
- Email –∞–∫—Ç–∏–≤–µ–Ω (is_active=True)

**–ü—Ä–∏–º–µ—Ä—ã –∞–¥—Ä–µ—Å–æ–≤:**
```
engineer@biomilk.com        (–ì–ª–∞–≤–Ω—ã–π –∏–Ω–∂–µ–Ω–µ—Ä —Ü–µ—Ö–∞)
workshop.safety@biomilk.com (–°–ª—É–∂–±–∞ –û–¢ —Ü–µ—Ö–∞)
foreman@biomilk.com         (–°—Ç–∞—Ä—à–∏–π –º–∞—Å—Ç–µ—Ä)
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
–ê–¥–º–∏–Ω–∫–∞ ‚Üí –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è ‚Üí –í—ã–±—Ä–∞—Ç—å –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ ‚Üí –°–µ–∫—Ü–∏—è "Email –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –¢–æ—á–Ω–∞—è –∞–¥—Ä–µ—Å–∞—Ü–∏—è (–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –¥–ª—è –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è)
- ‚úÖ –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–¥—Ä–µ—Å–æ–≤
- ‚úÖ –ï—Å—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–æ–ª–∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—è
- ‚úÖ –ú–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å (is_active=False)

---

### –ò—Å—Ç–æ—á–Ω–∏–∫ 2Ô∏è‚É£: Email –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞ –û–¢ (Employee.email)

**–ß—Ç–æ —ç—Ç–æ:**
Email-–∞–¥—Ä–µ—Å–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, —É –∫–æ—Ç–æ—Ä—ã—Ö –≤ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ñ–ª–∞–≥ `is_responsible_for_safety=True`.

**–°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏:**
```python
# Employee
class Employee:
    email = EmailField(blank=True)
    subdivision = ForeignKey(StructuralSubdivision)
    position = ForeignKey(Position)
    status = CharField()  # 'active', 'fired', ...

# Position
class Position:
    is_responsible_for_safety = BooleanField(default=False)
```

**–£—Å–ª–æ–≤–∏—è –≤–∫–ª—é—á–µ–Ω–∏—è:**
```python
Employee.objects.filter(
    subdivision=subdivision,              # –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –∏–∑ —ç—Ç–æ–≥–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
    status='active',                      # –ê–∫—Ç–∏–≤–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫
    position__is_responsible_for_safety=True,  # –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞ –û–¢
    email__isnull=False                   # Email –Ω–µ –ø—É—Å—Ç–æ–π
).exclude(email='')
```

**–ü—Ä–∏–º–µ—Ä—ã:**
```
ivanov.ii@biomilk.com   (–ò–≤–∞–Ω–æ–≤ –ò.–ò., –ò–Ω–∂–µ–Ω–µ—Ä –ø–æ –û–¢)
petrova.as@biomilk.com  (–ü–µ—Ç—Ä–æ–≤–∞ –ê.–°., –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –û–¢)
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
1. –í –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥–∞–ª–æ—á–∫—É "–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞ –û–¢"
2. –£ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª–µ Email

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö
- ‚úÖ –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å–∞ –≤—Ä—É—á–Ω—É—é

**–õ–æ–≥–∏–∫–∞:**
–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞ –û–¢ **—Å–∞–º –ø—Ä–æ–≤–æ–¥–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂–∏**, –ø–æ—ç—Ç–æ–º—É –µ–º—É –Ω—É–∂–µ–Ω –æ–±—Ä–∞–∑–µ—Ü –∂—É—Ä–Ω–∞–ª–∞.

---

### –ò—Å—Ç–æ—á–Ω–∏–∫ 3Ô∏è‚É£: Email –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (EmailSettings)

**–ß—Ç–æ —ç—Ç–æ:**
–û–±—â–∏–µ email-–∞–¥—Ä–µ—Å–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –≤—Å–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –≤ EmailSettings.

**–ú–æ–¥–µ–ª—å:**
```python
class EmailSettings(models.Model):
    organization = OneToOneField(Organization)
    recipient_emails = TextField()  # –ú–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–µ –ø–æ–ª–µ
    is_active = BooleanField(default=True)
    # ... SMTP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ...
```

**–§–æ—Ä–º–∞—Ç `recipient_emails`:**
```
hr@biomilk.com
director@biomilk.com
safety.department@biomilk.com
```
(–ü–æ –æ–¥–Ω–æ–º—É –∞–¥—Ä–µ—Å—É –Ω–∞ —Å—Ç—Ä–æ–∫—É)

**–ú–µ—Ç–æ–¥ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è:**
```python
def get_recipient_list(self):
    """–ü–∞—Ä—Å–∏—Ç —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ –≤ —Å–ø–∏—Å–æ–∫"""
    emails = [
        email.strip()
        for email in self.recipient_emails.strip().split('\n')
        if email.strip()
    ]
    return emails
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- EmailSettings —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- EmailSettings –∞–∫—Ç–∏–≤–µ–Ω (is_active=True)
- –ü–æ–ª–µ recipient_emails –Ω–µ –ø—É—Å—Ç–æ–µ

**–ü—Ä–∏–º–µ—Ä—ã –∞–¥—Ä–µ—Å–æ–≤:**
```
hr@biomilk.com              (–û—Ç–¥–µ–ª –∫–∞–¥—Ä–æ–≤)
director@biomilk.com        (–î–∏—Ä–µ–∫—Ç–æ—Ä)
safety.dept@biomilk.com     (–°–ª—É–∂–±–∞ –æ—Ö—Ä–∞–Ω—ã —Ç—Ä—É–¥–∞)
admin@biomilk.com           (–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
–ê–¥–º–∏–Ω–∫–∞ ‚Üí Deadline Control ‚Üí Email Settings (SMTP) ‚Üí –ü–æ–ª–µ "Email –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π"

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ï–¥–∏–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤—Å–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- ‚úÖ –í—Å–µ–≥–¥–∞ –∏–Ω—Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –∫–ª—é—á–µ–≤—ã–µ –ª–∏—Ü–∞ (HR, –¥–∏—Ä–µ–∫—Ç–æ—Ä)
- ‚úÖ Fallback –Ω–∞ —Å–ª—É—á–∞–π –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥—Ä—É–≥–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

---

## –ê–ª–≥–æ—Ä–∏—Ç–º —Å–±–æ—Ä–∞

### –ü—Å–µ–≤–¥–æ–∫–æ–¥

```
–§–£–ù–ö–¶–ò–Ø collect_recipients_for_subdivision(subdivision, organization):
    recipients = –ü–£–°–¢–û–ï_–ú–ù–û–ñ–ï–°–¢–í–û  // Set –¥–ª—è –∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

    // –®–ê–ì 1: Email –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
    –ï–°–õ–ò subdivision –ù–ï –ü–£–°–¢–û:
        subdivision_emails = SubdivisionEmail.query(
            subdivision=subdivision,
            is_active=True
        ).values(email)

        recipients.–î–û–ë–ê–í–ò–¢–¨_–í–°–ï(subdivision_emails)

    // –®–ê–ì 2: Email –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞ –û–¢
    –ï–°–õ–ò subdivision –ù–ï –ü–£–°–¢–û:
        responsible_emails = Employee.query(
            subdivision=subdivision,
            status='active',
            position.is_responsible_for_safety=True,
            email –ù–ï –ü–£–°–¢–û
        ).values(email)

        recipients.–î–û–ë–ê–í–ò–¢–¨_–í–°–ï(responsible_emails)

    // –®–ê–ì 3: Email –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
    –ü–û–ü–´–¢–ö–ê:
        email_settings = organization.email_settings

        –ï–°–õ–ò email_settings.is_active:
            org_emails = email_settings.get_recipient_list()
            recipients.–î–û–ë–ê–í–ò–¢–¨_–í–°–ï(org_emails)
    –û–ë–†–ê–ë–û–¢–ö–ê_–û–®–ò–ë–ö–ò:
        –õ–û–ì–ò–†–û–í–ê–¢–¨("EmailSettings –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è {organization}")

    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≤ —Å–ø–∏—Å–æ–∫
    –í–ï–†–ù–£–¢–¨ —Å–ø–∏—Å–æ–∫(recipients)
```

### Python-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

```python
def collect_recipients_for_subdivision(subdivision, organization):
    """
    –°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ—Ö –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –¥–ª—è –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è.

    Args:
        subdivision (StructuralSubdivision|None): –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ
        organization (Organization): –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è

    Returns:
        list[str]: –°–ø–∏—Å–æ–∫ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö email-–∞–¥—Ä–µ—Å–æ–≤
    """
    from directory.models import Employee
    import logging

    logger = logging.getLogger(__name__)
    recipients = set()  # Set –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

    # –ò–°–¢–û–ß–ù–ò–ö 1: Email –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
    if subdivision:
        subdivision_emails = subdivision.notification_emails.filter(
            is_active=True
        ).values_list('email', flat=True)

        recipients.update(subdivision_emails)
        logger.info(
            f"[–ò—Å—Ç–æ—á–Ω–∏–∫ 1] –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ '{subdivision.name}': "
            f"–Ω–∞–π–¥–µ–Ω–æ {len(subdivision_emails)} email"
        )

    # –ò–°–¢–û–ß–ù–ò–ö 2: Email –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞ –û–¢
    if subdivision:
        responsible_employees = Employee.objects.filter(
            subdivision=subdivision,
            status='active',
            position__is_responsible_for_safety=True,
            email__isnull=False
        ).exclude(email='').values_list('email', flat=True)

        recipients.update(responsible_employees)
        logger.info(
            f"[–ò—Å—Ç–æ—á–Ω–∏–∫ 2] –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞ –û–¢ –≤ '{subdivision.name}': "
            f"–Ω–∞–π–¥–µ–Ω–æ {len(responsible_employees)} email"
        )

    # –ò–°–¢–û–ß–ù–ò–ö 3: Email –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
    try:
        email_settings = organization.email_settings

        if email_settings.is_active:
            org_emails = email_settings.get_recipient_list()
            recipients.update(org_emails)
            logger.info(
                f"[–ò—Å—Ç–æ—á–Ω–∏–∫ 3] –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è '{organization.short_name_ru}': "
                f"–Ω–∞–π–¥–µ–Ω–æ {len(org_emails)} email"
            )
        else:
            logger.warning(
                f"EmailSettings –¥–ª—è '{organization.short_name_ru}' –æ—Ç–∫–ª—é—á–µ–Ω—ã"
            )
    except Exception as e:
        logger.warning(
            f"EmailSettings –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è '{organization.short_name_ru}': {e}"
        )

    # –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    logger.info(
        f"–ò–¢–û–ì–û –¥–ª—è '{subdivision.name if subdivision else '–±–µ–∑ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è'}': "
        f"{len(recipients)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π"
    )

    return list(recipients)
```

---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏ –ø—Ä–∞–≤–∏–ª–∞

### –ù–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ ‚Äî —Ç–æ–ª—å–∫–æ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ

**–í–∞–∂–Ω–æ:** –ò—Å—Ç–æ—á–Ω–∏–∫–∏ **–ù–ï –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤**. –í—Å–µ —Ç—Ä–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∏ –∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è.

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ò—Å—Ç–æ—á–Ω–∏–∫ 1     ‚îÇ ‚îÄ‚îÄ‚îê
‚îÇ  [A, B]         ‚îÇ   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
                      ‚îú‚îÄ‚îÄ‚ñ∫ –û–ë–™–ï–î–ò–ù–ï–ù–ò–ï ‚îÄ‚îÄ‚ñ∫ [A, B, C, D]
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ    (—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ)
‚îÇ  –ò—Å—Ç–æ—á–Ω–∏–∫ 2     ‚îÇ ‚îÄ‚îÄ‚î§
‚îÇ  [B, C]         ‚îÇ   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
                      ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  –ò—Å—Ç–æ—á–Ω–∏–∫ 3     ‚îÇ ‚îÄ‚îÄ‚îò
‚îÇ  [C, D]         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** Email –º–æ–∂–µ—Ç –≤—Å—Ç—Ä–µ—á–∞—Ç—å—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö.

**–ü—Ä–∏–º–µ—Ä:**
```
–ò—Å—Ç–æ—á–Ω–∏–∫ 1 (SubdivisionEmail): engineer@biomilk.com
–ò—Å—Ç–æ—á–Ω–∏–∫ 2 (Employee):         engineer@biomilk.com  ‚Üê —Ç–æ—Ç –∂–µ –∞–¥—Ä–µ—Å
–ò—Å—Ç–æ—á–Ω–∏–∫ 3 (EmailSettings):    hr@biomilk.com
```

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `set()` –≤ Python –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–±–∏—Ä–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã.

```python
recipients = set()  # –ú–Ω–æ–∂–µ—Å—Ç–≤–æ (set)
recipients.update(['a@test.com', 'b@test.com'])
recipients.update(['b@test.com', 'c@test.com'])  # 'b@test.com' –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è
print(list(recipients))  # ['a@test.com', 'b@test.com', 'c@test.com']
```

### –ü—Ä–∞–≤–∏–ª–∞ –≤–∫–ª—é—á–µ–Ω–∏—è/–∏—Å–∫–ª—é—á–µ–Ω–∏—è

| –£—Å–ª–æ–≤–∏–µ | –í–∫–ª—é—á–∞–µ—Ç—Å—è? | –ü—Ä–∏—á–∏–Ω–∞ |
|---------|-------------|---------|
| Email –ø—É—Å—Ç–æ–π (`''`) | ‚ùå –ù–µ—Ç | –ù–µ–∫—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å |
| Email = NULL | ‚ùå –ù–µ—Ç | –ù–µ –∑–∞–ø–æ–ª–Ω–µ–Ω |
| SubdivisionEmail.is_active = False | ‚ùå –ù–µ—Ç | –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω |
| Employee.status = 'fired' | ‚ùå –ù–µ—Ç | –£–≤–æ–ª–µ–Ω–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ |
| EmailSettings.is_active = False | ‚ùå –ù–µ—Ç | –û—Ç–∫–ª—é—á–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| Email –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π | ‚ö†Ô∏è –ó–∞–≤–∏—Å–∏—Ç | Django EmailField –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç |

### Fallback-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –ß—Ç–æ –µ—Å–ª–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –ø—É—Å—Ç—ã–µ?

```
–ò—Å—Ç–æ—á–Ω–∏–∫ 1 (SubdivisionEmail):  []  ‚Üê –ù–µ—Ç email
–ò—Å—Ç–æ—á–Ω–∏–∫ 2 (Employee):          []  ‚Üê –ù–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö
–ò—Å—Ç–æ—á–Ω–∏–∫ 3 (EmailSettings):     [hr@biomilk.com]  ‚Üê –ï—Å—Ç—å!

–ò–¢–û–ì–û: [hr@biomilk.com]  ‚úÖ –•–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–æ–ª—É—á–∞—Ç–µ–ª—å –µ—Å—Ç—å
```

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:** –í—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –ø—É—Å—Ç—ã–µ
```python
if not recipients:
    logger.warning(f"–ù–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –¥–ª—è {subdivision_name}")
    # –†–∞—Å—Å—ã–ª–∫–∞ –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
    return None
```

---

## –ü—Ä–∏–º–µ—Ä—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–≤—Å–µ 3 –∏—Å—Ç–æ—á–Ω–∏–∫–∞)

**–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

**–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:** –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π —Ü–µ—Ö

**–ò—Å—Ç–æ—á–Ω–∏–∫ 1 (SubdivisionEmail):**
```sql
subdivision_id | email                   | description        | is_active
1              | engineer@biomilk.com    | –ì–ª–∞–≤–Ω—ã–π –∏–Ω–∂–µ–Ω–µ—Ä    | TRUE
1              | foreman@biomilk.com     | –°—Ç–∞—Ä—à–∏–π –º–∞—Å—Ç–µ—Ä     | TRUE
```

**–ò—Å—Ç–æ—á–Ω–∏–∫ 2 (Employee):**
```sql
id  | full_name      | email              | position_id | subdivision_id | status
101 | –ò–≤–∞–Ω–æ–≤ –ò.–ò.    | ivanov@biomilk.com | 5 (–û–¢)      | 1              | active
```

**–ò—Å—Ç–æ—á–Ω–∏–∫ 3 (EmailSettings):**
```
hr@biomilk.com
director@biomilk.com
```

**–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:**
```python
collect_recipients_for_subdivision(
    subdivision=StructuralSubdivision(id=1, name="–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π —Ü–µ—Ö"),
    organization=Organization(id=1, short_name_ru="–û–û–û –ë–∏–æ–ú–∏–ª–∫")
)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```python
[
    'engineer@biomilk.com',     # –ò—Å—Ç–æ—á–Ω–∏–∫ 1
    'foreman@biomilk.com',      # –ò—Å—Ç–æ—á–Ω–∏–∫ 1
    'ivanov@biomilk.com',       # –ò—Å—Ç–æ—á–Ω–∏–∫ 2
    'hr@biomilk.com',           # –ò—Å—Ç–æ—á–Ω–∏–∫ 3
    'director@biomilk.com'      # –ò—Å—Ç–æ—á–Ω–∏–∫ 3
]
# –ò—Ç–æ–≥–æ: 5 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
```

**–õ–æ–≥–∏:**
```
[INFO] [–ò—Å—Ç–æ—á–Ω–∏–∫ 1] –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ '–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π —Ü–µ—Ö': –Ω–∞–π–¥–µ–Ω–æ 2 email
[INFO] [–ò—Å—Ç–æ—á–Ω–∏–∫ 2] –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞ –û–¢ –≤ '–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π —Ü–µ—Ö': –Ω–∞–π–¥–µ–Ω–æ 1 email
[INFO] [–ò—Å—Ç–æ—á–Ω–∏–∫ 3] –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è '–û–û–û –ë–∏–æ–ú–∏–ª–∫': –Ω–∞–π–¥–µ–Ω–æ 2 email
[INFO] –ò–¢–û–ì–û –¥–ª—è '–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π —Ü–µ—Ö': 5 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –¢–æ–ª—å–∫–æ email –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

**–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

**–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:** –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∫–æ—Ä–ø—É—Å

**–ò—Å—Ç–æ—á–Ω–∏–∫ 1:** –ü—É—Å—Ç–æ (–Ω–µ—Ç SubdivisionEmail)

**–ò—Å—Ç–æ—á–Ω–∏–∫ 2:** –ü—É—Å—Ç–æ (–Ω–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞ –û–¢ —Å email)

**–ò—Å—Ç–æ—á–Ω–∏–∫ 3 (EmailSettings):**
```
admin@biomilk.com
hr@biomilk.com
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```python
[
    'admin@biomilk.com',  # –ò—Å—Ç–æ—á–Ω–∏–∫ 3
    'hr@biomilk.com'      # –ò—Å—Ç–æ—á–Ω–∏–∫ 3
]
# –ò—Ç–æ–≥–æ: 2 –ø–æ–ª—É—á–∞—Ç–µ–ª—è (—Ç–æ–ª—å–∫–æ –∏–∑ EmailSettings)
```

**–õ–æ–≥–∏:**
```
[INFO] [–ò—Å—Ç–æ—á–Ω–∏–∫ 1] –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∫–æ—Ä–ø—É—Å': –Ω–∞–π–¥–µ–Ω–æ 0 email
[INFO] [–ò—Å—Ç–æ—á–Ω–∏–∫ 2] –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞ –û–¢ –≤ '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∫–æ—Ä–ø—É—Å': –Ω–∞–π–¥–µ–Ω–æ 0 email
[INFO] [–ò—Å—Ç–æ—á–Ω–∏–∫ 3] –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è '–û–û–û –ë–∏–æ–ú–∏–ª–∫': –Ω–∞–π–¥–µ–Ω–æ 2 email
[INFO] –ò–¢–û–ì–û –¥–ª—è '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∫–æ—Ä–ø—É—Å': 2 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –° –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏

**–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

**–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:** –°–∫–ª–∞–¥—Å–∫–æ–µ —Ö–æ–∑—è–π—Å—Ç–≤–æ

**–ò—Å—Ç–æ—á–Ω–∏–∫ 1:**
```
safety@biomilk.com      (–°–ª—É–∂–±–∞ –û–¢)
```

**–ò—Å—Ç–æ—á–Ω–∏–∫ 2:**
```
safety@biomilk.com      (–ü–µ—Ç—Ä–æ–≤ –ü.–ü., –ò–Ω–∂–µ–Ω–µ—Ä –ø–æ –û–¢) ‚Üê –î–£–ë–õ–ò–ö–ê–¢
```

**–ò—Å—Ç–æ—á–Ω–∏–∫ 3:**
```
hr@biomilk.com
safety@biomilk.com      ‚Üê –î–£–ë–õ–ò–ö–ê–¢
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç (–±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤):**
```python
[
    'safety@biomilk.com',  # –í—Å—Ç—Ä–µ—á–∞–ª—Å—è 3 —Ä–∞–∑–∞, –æ—Å—Ç–∞–≤–ª–µ–Ω 1 —Ä–∞–∑
    'hr@biomilk.com'
]
# –ò—Ç–æ–≥–æ: 2 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—É—á–∞—Ç–µ–ª—è (–¥—É–±–ª–∏–∫–∞—Ç—ã —É–¥–∞–ª–µ–Ω—ã)
```

**–ü—Ä–æ—Ü–µ—Å—Å —É–¥–∞–ª–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:**
```
–®–∞–≥ 1: recipients = {}
–®–∞–≥ 2: recipients.update(['safety@biomilk.com'])          ‚Üí {'safety@biomilk.com'}
–®–∞–≥ 3: recipients.update(['safety@biomilk.com'])          ‚Üí {'safety@biomilk.com'}  (–¥—É–±–ª–∏–∫–∞—Ç –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)
–®–∞–≥ 4: recipients.update(['hr@biomilk.com', 'safety@...']) ‚Üí {'safety@biomilk.com', 'hr@biomilk.com'}
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ù–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Ç—É–∞—Ü–∏—è)

**–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

**–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:** –ù–æ–≤—ã–π —Ü–µ—Ö (—Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–Ω)

**–ò—Å—Ç–æ—á–Ω–∏–∫ 1:** –ü—É—Å—Ç–æ
**–ò—Å—Ç–æ—á–Ω–∏–∫ 2:** –ü—É—Å—Ç–æ
**–ò—Å—Ç–æ—á–Ω–∏–∫ 3:** EmailSettings –ù–ï –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```python
[]  # –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
```

**–õ–æ–≥–∏:**
```
[INFO] [–ò—Å—Ç–æ—á–Ω–∏–∫ 1] –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ '–ù–æ–≤—ã–π —Ü–µ—Ö': –Ω–∞–π–¥–µ–Ω–æ 0 email
[INFO] [–ò—Å—Ç–æ—á–Ω–∏–∫ 2] –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞ –û–¢ –≤ '–ù–æ–≤—ã–π —Ü–µ—Ö': –Ω–∞–π–¥–µ–Ω–æ 0 email
[WARNING] EmailSettings –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è '–û–û–û –ë–∏–æ–ú–∏–ª–∫': Organization has no email_settings.
[WARNING] –ù–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –¥–ª—è –ù–æ–≤—ã–π —Ü–µ—Ö
```

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:**
```python
recipients = collect_recipients_for_subdivision(subdivision, organization)

if not recipients:
    logger.warning(f"–ù–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –¥–ª—è {subdivision.name}")
    messages.warning(request, f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ –¥–ª—è '{subdivision.name}': –Ω–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π")
    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
    continue
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –±–µ–∑ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è

**–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

**–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:** `None` (—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –ø—Ä–∏–≤—è–∑–∞–Ω—ã —Ç–æ–ª—å–∫–æ –∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏)

**–ò—Å—Ç–æ—á–Ω–∏–∫ 1:** ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–µ—Ç subdivision)
**–ò—Å—Ç–æ—á–Ω–∏–∫ 2:** ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–µ—Ç subdivision –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞)
**–ò—Å—Ç–æ—á–Ω–∏–∫ 3:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```python
[
    'hr@biomilk.com',       # –ò—Å—Ç–æ—á–Ω–∏–∫ 3
    'director@biomilk.com'  # –ò—Å—Ç–æ—á–Ω–∏–∫ 3
]
# –¢–æ–ª—å–∫–æ email –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
```

**–õ–æ–≥–∏–∫–∞ –≤ –∫–æ–¥–µ:**
```python
# –ò—Å—Ç–æ—á–Ω–∏–∫–∏ 1 –∏ 2 –ø—Ä–æ–≤–µ—Ä—è—é—Ç: if subdivision:
if subdivision:
    # –°–æ–±–∏—Ä–∞–µ–º email –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
    # –°–æ–±–∏—Ä–∞–µ–º email –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö
# else: –ø—Ä–æ–ø—É—Å–∫–∞–µ–º

# –ò—Å—Ç–æ—á–Ω–∏–∫ 3 —Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ–≥–¥–∞ (–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç subdivision)
```

---

## –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏

### –°–ª—É—á–∞–π 1: –û—Ç–∫–ª—é—á–µ–Ω–Ω—ã–µ email

**–°–∏—Ç—É–∞—Ü–∏—è:**
```sql
SubdivisionEmail:
  email: old.engineer@biomilk.com, is_active=FALSE  ‚Üê –æ—Ç–∫–ª—é—á–µ–Ω
  email: new.engineer@biomilk.com, is_active=TRUE   ‚Üê –∞–∫—Ç–∏–≤–µ–Ω
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```python
['new.engineer@biomilk.com']  # –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–π
```

**–§–∏–ª—å—Ç—Ä –≤ –∫–æ–¥–µ:**
```python
subdivision.notification_emails.filter(is_active=True)
```

---

### –°–ª—É—á–∞–π 2: –£–≤–æ–ª–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞ –û–¢

**–°–∏—Ç—É–∞—Ü–∏—è:**
```sql
Employee:
  id: 101, email: fired.ot@biomilk.com, status='fired', position.is_responsible=True
  id: 102, email: new.ot@biomilk.com, status='active', position.is_responsible=True
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```python
['new.ot@biomilk.com']  # –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–π
```

**–§–∏–ª—å—Ç—Ä –≤ –∫–æ–¥–µ:**
```python
Employee.objects.filter(
    status='active',  # –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ
    position__is_responsible_for_safety=True
)
```

---

### –°–ª—É—á–∞–π 3: –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π email

**–°–∏—Ç—É–∞—Ü–∏—è:**
```sql
SubdivisionEmail:
  email: 'invalid-email'  ‚Üê –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
```

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
- Django `EmailField` –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ –∞–¥–º–∏–Ω–∫–µ
- –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π email **–Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω** –≤ –ë–î
- –ï—Å–ª–∏ –∫–∞–∫-—Ç–æ –ø–æ–ø–∞–ª (–º–∏–≥—Ä–∞—Ü–∏—è, –ø—Ä—è–º–æ–π SQL) ‚Äî –±—É–¥–µ—Ç –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ SMTP

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
```python
# –í –º–æ–¥–µ–ª–∏:
email = models.EmailField()  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

# –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ:
try:
    email.send(fail_silently=False)
except SMTPException as e:
    logger.error(f"–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π email: {e}")
```

---

### –°–ª—É—á–∞–π 4: –ü—É—Å—Ç–æ–µ –ø–æ–ª–µ recipient_emails

**–°–∏—Ç—É–∞—Ü–∏—è:**
```python
EmailSettings:
  recipient_emails = ""  # –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```python
email_settings.get_recipient_list()  # –í–µ—Ä–Ω—ë—Ç []
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è get_recipient_list():**
```python
def get_recipient_list(self):
    if not self.recipient_emails:
        return []

    emails = [
        email.strip()
        for email in self.recipient_emails.strip().split('\n')
        if email.strip()  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
    ]
    return emails
```

---

### –°–ª—É—á–∞–π 5: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

**–°–∏—Ç—É–∞—Ü–∏—è:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º.

**–í–æ–ø—Ä–æ—Å:** –ö–∞–∫–∏–µ email –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è?

**–û—Ç–≤–µ—Ç:** Email –∏–∑ EmailSettings **–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏**, –∫ –∫–æ—Ç–æ—Ä–æ–π –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ.

```python
# –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–æ –∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
subdivision.organization  # Organization(id=1, name="–û–û–û –ë–∏–æ–ú–∏–ª–∫")

# –ë–µ—Ä—ë–º EmailSettings –∏–º–µ–Ω–Ω–æ —ç—Ç–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
email_settings = subdivision.organization.email_settings
```

**–ù–ï —Å–º–µ—à–∏–≤–∞—é—Ç—Å—è** email –∏–∑ —Ä–∞–∑–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π.

---

## –ë–ª–æ–∫-—Å—Ö–µ–º–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∞

```
                        –ù–ê–ß–ê–õ–û
                           ‚îÇ
                           ‚ñº
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ –í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:           ‚îÇ
            ‚îÇ - subdivision                ‚îÇ
            ‚îÇ - organization               ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚ñº
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ recipients = set()           ‚îÇ
            ‚îÇ (–ø—É—Å—Ç–æ–µ –º–Ω–æ–∂–µ—Å—Ç–≤–æ)           ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                  ‚îÇ                  ‚îÇ
        ‚ñº                  ‚ñº                  ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ–ò–°–¢–û–ß–ù–ò–ö‚îÇ        ‚îÇ–ò–°–¢–û–ß–ù–ò–ö‚îÇ        ‚îÇ–ò–°–¢–û–ß–ù–ò–ö‚îÇ
   ‚îÇ   1    ‚îÇ        ‚îÇ   2    ‚îÇ        ‚îÇ   3    ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                 ‚îÇ                 ‚îÇ
        ‚ñº                 ‚ñº                 ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇsubdivision  ‚îÇ  ‚îÇEmployee.query‚îÇ  ‚îÇEmailSettings ‚îÇ
   ‚îÇ  != None?   ‚îÇ  ‚îÇsubdivision   ‚îÇ  ‚îÇ.get_recipient‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ  + active    ‚îÇ  ‚îÇ_list()       ‚îÇ
         ‚îÇ –î–∞       ‚îÇ  + is_resp   ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚ñº          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ                 ‚îÇ
   ‚îÇSubdivisionE-‚îÇ         ‚îÇ                 ‚îÇ
   ‚îÇmail.filter( ‚îÇ         ‚îÇ                 ‚îÇ
   ‚îÇactive=True) ‚îÇ         ‚îÇ                 ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ                 ‚îÇ
         ‚îÇ                 ‚îÇ                 ‚îÇ
         ‚ñº                 ‚ñº                 ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ   recipients.update(emails)             ‚îÇ
   ‚îÇ   (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –º–Ω–æ–∂–µ—Å—Ç–≤–æ)              ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ
                 ‚ñº
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ recipients   ‚îÇ –ù–µ—Ç
          ‚îÇ –ø—É—Å—Ç–æ–µ?      ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
                 ‚îÇ –î–∞               ‚îÇ
                 ‚ñº                  ‚ñº
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å   ‚îÇ   ‚îÇ –í–µ—Ä–Ω—É—Ç—å     ‚îÇ
          ‚îÇ WARNING      ‚îÇ   ‚îÇ list(recip) ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ                  ‚îÇ
                 ‚ñº                  ‚îÇ
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
          ‚îÇ –í–µ—Ä–Ω—É—Ç—å []   ‚îÇ         ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
                 ‚îÇ                  ‚îÇ
                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚ñº
                        –ö–û–ù–ï–¶
```

---

## –ö–æ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–∏

**–§–∞–π–ª:** `directory/utils/email_recipients.py`

```python
"""
–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Å–±–æ—Ä–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π email-—Ä–∞—Å—Å—ã–ª–æ–∫
"""
import logging
from typing import List, Optional
from directory.models import Employee, StructuralSubdivision, Organization

logger = logging.getLogger(__name__)


def collect_recipients_for_subdivision(
    subdivision: Optional[StructuralSubdivision],
    organization: Organization
) -> List[str]:
    """
    –°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ—Ö –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π email –¥–ª—è –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∏–∑ —Ç—Ä—ë—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:
    1. SubdivisionEmail (email –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è)
    2. Employee.email (–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞ –û–¢)
    3. EmailSettings.recipient_emails (–æ–±—â–∏–µ email –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏)

    Args:
        subdivision: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ (–º–æ–∂–µ—Ç –±—ã—Ç—å None)
        organization: –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è

    Returns:
        –°–ø–∏—Å–æ–∫ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö email-–∞–¥—Ä–µ—Å–æ–≤ (–±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)

    Examples:
        >>> collect_recipients_for_subdivision(
        ...     subdivision=StructuralSubdivision.objects.get(name="–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π —Ü–µ—Ö"),
        ...     organization=Organization.objects.get(short_name_ru="–û–û–û –ë–∏–æ–ú–∏–ª–∫")
        ... )
        ['engineer@biomilk.com', 'ivanov@biomilk.com', 'hr@biomilk.com']
    """
    recipients = set()  # –ò—Å–ø–æ–ª—å–∑—É–µ–º set –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
    subdivision_name = subdivision.name if subdivision else "–±–µ–∑ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è"

    # ==========================================
    # –ò–°–¢–û–ß–ù–ò–ö 1: Email –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
    # ==========================================
    if subdivision:
        try:
            subdivision_emails = subdivision.notification_emails.filter(
                is_active=True
            ).values_list('email', flat=True)

            count = len(subdivision_emails)
            if count > 0:
                recipients.update(subdivision_emails)
                logger.info(
                    f"[–ò—Å—Ç–æ—á–Ω–∏–∫ 1: SubdivisionEmail] –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ '{subdivision.name}': "
                    f"–Ω–∞–π–¥–µ–Ω–æ {count} –∞–∫—Ç–∏–≤–Ω—ã—Ö email"
                )
            else:
                logger.debug(
                    f"[–ò—Å—Ç–æ—á–Ω–∏–∫ 1: SubdivisionEmail] –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ '{subdivision.name}': "
                    f"email –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã"
                )
        except Exception as e:
            logger.warning(
                f"[–ò—Å—Ç–æ—á–Ω–∏–∫ 1: SubdivisionEmail] –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è email –¥–ª—è '{subdivision.name}': {e}"
            )

    # ==========================================
    # –ò–°–¢–û–ß–ù–ò–ö 2: Email –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞ –û–¢
    # ==========================================
    if subdivision:
        try:
            responsible_employees = Employee.objects.filter(
                subdivision=subdivision,
                status='active',
                position__is_responsible_for_safety=True,
                email__isnull=False
            ).exclude(
                email=''
            ).values_list('email', flat=True)

            count = len(responsible_employees)
            if count > 0:
                recipients.update(responsible_employees)
                logger.info(
                    f"[–ò—Å—Ç–æ—á–Ω–∏–∫ 2: Employee] –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞ –û–¢ –≤ '{subdivision.name}': "
                    f"–Ω–∞–π–¥–µ–Ω–æ {count} email"
                )
            else:
                logger.debug(
                    f"[–ò—Å—Ç–æ—á–Ω–∏–∫ 2: Employee] –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞ –û–¢ –≤ '{subdivision.name}': "
                    f"–Ω–µ –Ω–∞–π–¥–µ–Ω—ã –∏–ª–∏ email –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã"
                )
        except Exception as e:
            logger.warning(
                f"[–ò—Å—Ç–æ—á–Ω–∏–∫ 2: Employee] –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞ –û–¢ –¥–ª—è '{subdivision.name}': {e}"
            )

    # ==========================================
    # –ò–°–¢–û–ß–ù–ò–ö 3: Email –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
    # ==========================================
    try:
        email_settings = organization.email_settings

        if email_settings.is_active:
            org_emails = email_settings.get_recipient_list()
            count = len(org_emails)

            if count > 0:
                recipients.update(org_emails)
                logger.info(
                    f"[–ò—Å—Ç–æ—á–Ω–∏–∫ 3: EmailSettings] –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è '{organization.short_name_ru}': "
                    f"–Ω–∞–π–¥–µ–Ω–æ {count} email"
                )
            else:
                logger.debug(
                    f"[–ò—Å—Ç–æ—á–Ω–∏–∫ 3: EmailSettings] –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è '{organization.short_name_ru}': "
                    f"email –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã"
                )
        else:
            logger.warning(
                f"[–ò—Å—Ç–æ—á–Ω–∏–∫ 3: EmailSettings] EmailSettings –¥–ª—è '{organization.short_name_ru}' –æ—Ç–∫–ª—é—á–µ–Ω—ã (is_active=False)"
            )

    except organization._meta.model.email_settings.RelatedObjectDoesNotExist:
        logger.warning(
            f"[–ò—Å—Ç–æ—á–Ω–∏–∫ 3: EmailSettings] EmailSettings –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ '{organization.short_name_ru}'"
        )
    except Exception as e:
        logger.error(
            f"[–ò—Å—Ç–æ—á–Ω–∏–∫ 3: EmailSettings] –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è '{organization.short_name_ru}': {e}"
        )

    # ==========================================
    # –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê
    # ==========================================
    total_count = len(recipients)

    if total_count > 0:
        logger.info(
            f"‚úÖ –ò–¢–û–ì–û –¥–ª—è '{subdivision_name}': {total_count} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π"
        )
    else:
        logger.warning(
            f"‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –î–ª—è '{subdivision_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—è! "
            f"–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SubdivisionEmail, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞ –û–¢ –∏–ª–∏ EmailSettings."
        )

    return list(recipients)


def validate_email_list(emails: List[str]) -> List[str]:
    """
    –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ email-–∞–¥—Ä–µ—Å–æ–≤.

    Args:
        emails: –°–ø–∏—Å–æ–∫ email-–∞–¥—Ä–µ—Å–æ–≤

    Returns:
        –°–ø–∏—Å–æ–∫ –≤–∞–ª–∏–¥–Ω—ã—Ö email-–∞–¥—Ä–µ—Å–æ–≤

    Raises:
        ValidationError: –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ email
    """
    from django.core.validators import validate_email
    from django.core.exceptions import ValidationError

    valid_emails = []
    invalid_emails = []

    for email in emails:
        try:
            validate_email(email)
            valid_emails.append(email)
        except ValidationError:
            invalid_emails.append(email)
            logger.warning(f"–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π email: {email}")

    if invalid_emails:
        raise ValidationError(f"–ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ email-–∞–¥—Ä–µ—Å–∞: {', '.join(invalid_emails)}")

    return valid_emails
```

### –¢–µ—Å—Ç—ã

**–§–∞–π–ª:** `directory/tests/test_email_recipients.py`

```python
from django.test import TestCase
from directory.models import Organization, StructuralSubdivision, Employee, Position, SubdivisionEmail
from deadline_control.models import EmailSettings
from directory.utils.email_recipients import collect_recipients_for_subdivision


class EmailRecipientsTestCase(TestCase):
    """–¢–µ—Å—Ç—ã –¥–ª—è –ª–æ–≥–∏–∫–∏ —Å–±–æ—Ä–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π email"""

    def setUp(self):
        """–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö"""
        # –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è
        self.org = Organization.objects.create(
            short_name_ru="–û–û–û –¢–µ—Å—Ç",
            full_name_ru="–û–±—â–µ—Å—Ç–≤–æ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é –¢–µ—Å—Ç"
        )

        # –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ
        self.subdivision = StructuralSubdivision.objects.create(
            name="–¢–µ—Å—Ç–æ–≤—ã–π —Ü–µ—Ö",
            organization=self.org
        )

        # EmailSettings
        self.email_settings = EmailSettings.objects.create(
            organization=self.org,
            is_active=True,
            recipient_emails="hr@test.com\ndirector@test.com"
        )

        # –î–æ–ª–∂–Ω–æ—Å—Ç—å (–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞ –û–¢)
        self.position_ot = Position.objects.create(
            position_name="–ò–Ω–∂–µ–Ω–µ—Ä –ø–æ –û–¢",
            organization=self.org,
            is_responsible_for_safety=True
        )

    def test_all_three_sources(self):
        """–¢–µ—Å—Ç: –≤—Å–µ —Ç—Ä–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç email"""
        # –ò—Å—Ç–æ—á–Ω–∏–∫ 1
        SubdivisionEmail.objects.create(
            subdivision=self.subdivision,
            email="engineer@test.com",
            is_active=True
        )

        # –ò—Å—Ç–æ—á–Ω–∏–∫ 2
        Employee.objects.create(
            full_name_nominative="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
            organization=self.org,
            subdivision=self.subdivision,
            position=self.position_ot,
            status='active',
            email="ivanov@test.com"
        )

        # –ò—Å—Ç–æ—á–Ω–∏–∫ 3 (—É–∂–µ —Å–æ–∑–¥–∞–Ω –≤ setUp)

        # –°–±–æ—Ä –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
        recipients = collect_recipients_for_subdivision(self.subdivision, self.org)

        # –ü—Ä–æ–≤–µ—Ä–∫–∏
        self.assertEqual(len(recipients), 4)  # 1 + 1 + 2
        self.assertIn('engineer@test.com', recipients)  # –ò—Å—Ç–æ—á–Ω–∏–∫ 1
        self.assertIn('ivanov@test.com', recipients)    # –ò—Å—Ç–æ—á–Ω–∏–∫ 2
        self.assertIn('hr@test.com', recipients)        # –ò—Å—Ç–æ—á–Ω–∏–∫ 3
        self.assertIn('director@test.com', recipients)  # –ò—Å—Ç–æ—á–Ω–∏–∫ 3

    def test_duplicates_removed(self):
        """–¢–µ—Å—Ç: –¥—É–±–ª–∏–∫–∞—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è"""
        # –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ email –≤ –¥–≤—É—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö
        SubdivisionEmail.objects.create(
            subdivision=self.subdivision,
            email="same@test.com",
            is_active=True
        )

        Employee.objects.create(
            full_name_nominative="–ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤–∏—á",
            organization=self.org,
            subdivision=self.subdivision,
            position=self.position_ot,
            status='active',
            email="same@test.com"  # –î—É–±–ª–∏–∫–∞—Ç
        )

        recipients = collect_recipients_for_subdivision(self.subdivision, self.org)

        # –ü—Ä–æ–≤–µ—Ä–∫–∞: –¥—É–±–ª–∏–∫–∞—Ç —É–¥–∞–ª—ë–Ω
        self.assertEqual(recipients.count('same@test.com'), 1)

    def test_no_recipients(self):
        """–¢–µ—Å—Ç: –Ω–µ—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π (–ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç)"""
        # –£–¥–∞–ª—è–µ–º EmailSettings
        self.email_settings.delete()

        # –ù–µ—Ç SubdivisionEmail, –Ω–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö

        recipients = collect_recipients_for_subdivision(self.subdivision, self.org)

        # –ü—Ä–æ–≤–µ—Ä–∫–∞: –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
        self.assertEqual(len(recipients), 0)

    def test_inactive_excluded(self):
        """–¢–µ—Å—Ç: –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ email –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è"""
        SubdivisionEmail.objects.create(
            subdivision=self.subdivision,
            email="inactive@test.com",
            is_active=False  # –ù–µ–∞–∫—Ç–∏–≤–µ–Ω
        )

        recipients = collect_recipients_for_subdivision(self.subdivision, self.org)

        # –ü—Ä–æ–≤–µ—Ä–∫–∞: –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–π email –Ω–µ –≤–∫–ª—é—á—ë–Ω
        self.assertNotIn('inactive@test.com', recipients)
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –ª–æ–≥–∏–∫–∏

1. **–¢—Ä–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–∞** ‚Äî —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
2. **–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –±–µ–∑ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤** ‚Äî –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—É–º–º–∏—Ä—É—é—Ç—Å—è
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤** ‚Äî —á–µ—Ä–µ–∑ Python `set()`
4. **Fail-safe –ø–æ–¥—Ö–æ–¥** ‚Äî –µ—Å–ª–∏ –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ—Å—Ç–∞–ª—å–Ω—ã–µ
5. **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –∫–∞–∂–¥—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ª–æ–≥–∏—Ä—É–µ—Ç —Å–≤–æ–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–¥—Ö–æ–¥–∞

- ‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å** ‚Äî –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
- ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å** ‚Äî fallback –Ω–∞ –¥—Ä—É–≥–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –ø—Ä–∏ —Å–±–æ–µ
- ‚úÖ **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –æ—Ç—Å–ª–µ–¥–∏—Ç—å –æ—Ç–∫—É–¥–∞ –≤–∑—è–ª–∏—Å—å email
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** ‚Äî –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å 4-–π, 5-–π –∏—Å—Ç–æ—á–Ω–∏–∫
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Äî –ø–æ–Ω—è—Ç–Ω—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è email

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**
- –ó–∞–ø–æ–ª–Ω–∏—Ç–µ EmailSettings –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ ‚Üí –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è –≤—Å–µ—Ö –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π

**–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**
- EmailSettings (–æ–±—â–∏–µ –∞–¥—Ä–µ—Å–∞)
- + SubdivisionEmail (—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π)
- + Employee.email –¥–ª—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞ –û–¢

**–ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**
- –í—Å–µ —Ç—Ä–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ ‚Üí –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 02.12.2025
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0
**–ê–≤—Ç–æ—Ä:** Claude Code (Anthropic)
