# –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∞–¥–º–∏–Ω–∫–∏ "–ö–ª—é—á–µ–≤—ã–µ —Å—Ä–æ–∫–∏"

## –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ–Ω—é "–ö–æ–Ω—Ç—Ä–æ–ª—å —Å—Ä–æ–∫–æ–≤"

### –ì—Ä—É–ø–ø–∞: –ö–æ–Ω—Ç—Ä–æ–ª—å —Å—Ä–æ–∫–æ–≤

–í–∫–ª—é—á–∞–µ—Ç –ø—É–Ω–∫—Ç—ã:
1. **–¢–û –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è** - –∫–æ–Ω—Ç—Ä–æ–ª—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
2. **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫)** - —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∫–ª—é—á–µ–≤—ã—Ö —Å—Ä–æ–∫–æ–≤ (–±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º)
3. **–ú–µ–¥–æ—Å–º–æ—Ç—Ä—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤** - –∫–æ–Ω—Ç—Ä–æ–ª—å –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –æ—Å–º–æ—Ç—Ä–æ–≤
4. **üìÖ –ö–ª—é—á–µ–≤—ã–µ —Å—Ä–æ–∫–∏** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è–º–∏ –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º

---

## –°—Ç—Ä–∞–Ω–∏—Ü–∞ "üìÖ –ö–ª—é—á–µ–≤—ã–µ —Å—Ä–æ–∫–∏"

**URL:** `/admin/deadline_control/keydeadlineitem/`

### –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ

**–°–ø–∏—Å–æ–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π** —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–∞—Å–∫—Ä—ã—Ç—å –∫–∞–∂–¥—É—é –∏ —É–≤–∏–¥–µ—Ç—å –µ—ë –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è

#### –¢–∞–±–ª–∏—Ü–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π

–ö–æ–ª–æ–Ω–∫–∏:
- **–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏** (short_name_ru)
- **–ê–∫—Ç–∏–≤–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π** (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ is_active=True)
- **–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö** (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å next_date < today, —Å —Ü–≤–µ—Ç–æ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π üö®)

#### –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é

–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è **—Ñ–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏** —Å –∏–Ω–ª–∞–π–Ω–æ–º **"üìÖ –ö–ª—é—á–µ–≤—ã–µ —Å—Ä–æ–∫–∏"**

---

## –ò–Ω–ª–∞–π–Ω "üìÖ –ö–ª—é—á–µ–≤—ã–µ —Å—Ä–æ–∫–∏"

**–ò—Å—Ç–æ—á–Ω–∏–∫:** –í–∑—è—Ç—å –∏–∑ `/admin/directory/organization/1/change/` (–±–ª–æ–∫ KeyDeadlineItemInline)

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `directory/admin/organization.py:12-20`

### –ü–æ–ª—è –∏–Ω–ª–∞–π–Ω–∞

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ |
|------|-----|----------|--------------|
| **–ö–∞—Ç–µ–≥–æ—Ä–∏—è** | ForeignKey | –í—ã–±–æ—Ä –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π | ‚úÖ –î–∞ |
| **–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è** | CharField | –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ | ‚úÖ –î–∞ |
| **–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è** | DateField | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è | ‚úÖ –î–∞ |
| **–î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ** | DateField | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è | üîí –¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ |
| **–°—Ä–æ–∫ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è (–º–µ—Å—è—Ü–µ–≤)** | PositiveIntegerField | –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ | ‚ùå –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ |
| **–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –ª–∏—Ü–æ** | CharField | –§–ò–û –∏–ª–∏ email | ‚ùå –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ |
| **–ê–∫—Ç–∏–≤–Ω–æ** | BooleanField | –£—á–∞—Å—Ç–≤—É–µ—Ç –ª–∏ –≤ —Ä–∞—Å—Å—ã–ª–∫–∞—Ö | ‚úÖ –î–∞ (default=True) |

### –õ–æ–≥–∏–∫–∞ "–°—Ä–æ–∫ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è (–º–µ—Å—è—Ü–µ–≤)" (periodicity_months)

```python
# –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–π –¥–∞—Ç—ã (–∏–∑ KeyDeadlineItem.calculate_next_date):
periodicity = self.periodicity_months or self.category.periodicity_months
```

**–ü—Ä–∞–≤–∏–ª–∞:**
1. ‚úÖ –ü–æ–ª–µ **–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º** (null=True, blank=True)
2. ‚úÖ –ï—Å–ª–∏ **—É–∫–∞–∑–∞–Ω–æ** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–π –¥–∞—Ç—ã
3. ‚úÖ –ï—Å–ª–∏ **–ø—É—Å—Ç–æ** - –±–µ—Ä—ë—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (`category.periodicity_months`)
4. ‚úÖ –°–ª–µ–¥—É—é—â–∞—è –¥–∞—Ç–∞ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

**–ü—Ä–∏–º–µ—Ä:**
- –ö–∞—Ç–µ–≥–æ—Ä–∏—è: "–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–∫—Ç–∞–∂", –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å: 6 –º–µ—Å—è—Ü–µ–≤
- –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ 1: periodicity_months = –ø—É—Å—Ç–æ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 6 –º–µ—Å—è—Ü–µ–≤
- –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ 2: periodicity_months = 3 ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 3 –º–µ—Å—è—Ü–∞ (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

1. **–ò–∑–º–µ–Ω–∏—Ç—å `KeyDeadlineItemAdmin`** (`deadline_control/admin/key_deadline.py`)
   - –í–º–µ—Å—Ç–æ –ø–ª–æ—Å–∫–æ–≥–æ —Å–ø–∏—Å–∫–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
   - –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–ª–∞–π–Ω `KeyDeadlineItemInline`
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏: –Ω–∞–∑–≤–∞–Ω–∏–µ, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö

2. **–£–±—Ä–∞—Ç—å –∏–Ω–ª–∞–π–Ω –∏–∑ `OrganizationAdmin`** (`directory/admin/organization.py`)
   - –£–¥–∞–ª–∏—Ç—å `KeyDeadlineItemInline` –∏–∑ `inlines`
   - –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞)

3. **–£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–π —Ñ–∞–π–ª** (`deadline_control/admin/organization_key_deadlines.py`)
   - –§–∞–π–ª –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, —Å–æ–∑–¥–∞—ë—Ç –ø—É—Ç–∞–Ω–∏—Ü—É

### –ß—Ç–æ –æ—Å—Ç–∞—ë—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

- ‚úÖ –ú–æ–¥–µ–ª—å `KeyDeadlineItem` - –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ú–æ–¥–µ–ª—å `KeyDeadlineCategory` - —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ `send_key_deadline_notifications` - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ - –≤—Å–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```python
def get_queryset(self, request):
    qs = super().get_queryset(request)
    if not request.user.is_superuser and hasattr(request.user, 'profile'):
        allowed_orgs = request.user.profile.organizations.all()
        qs = qs.filter(pk__in=allowed_orgs)
    return qs
```

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–∫—Ä–æ–º–µ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).

### –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö

```python
def overdue_items_count(self, obj):
    items = obj.key_deadline_items.filter(is_active=True)
    count = sum(1 for item in items if item.is_overdue())
    if count > 0:
        return format_html('<span style="color:red; font-weight:bold;">üö® {}</span>', count)
    return format_html('<span style="color:green;">‚úÖ 0</span>')
```

---

## –ò—Ç–æ–≥–æ–≤–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è

```
–ö–æ–Ω—Ç—Ä–æ–ª—å —Å—Ä–æ–∫–æ–≤
‚îú‚îÄ‚îÄ –¢–û –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫)
‚îú‚îÄ‚îÄ –ú–µ–¥–æ—Å–º–æ—Ç—Ä—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
‚îî‚îÄ‚îÄ üìÖ –ö–ª—é—á–µ–≤—ã–µ —Å—Ä–æ–∫–∏
    ‚îî‚îÄ‚îÄ /admin/deadline_control/keydeadlineitem/
        ‚îú‚îÄ‚îÄ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è 1
        ‚îÇ   ‚îú‚îÄ‚îÄ –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ 1
        ‚îÇ   ‚îú‚îÄ‚îÄ –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ 2
        ‚îÇ   ‚îî‚îÄ‚îÄ ...
        ‚îú‚îÄ‚îÄ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è 2
        ‚îÇ   ‚îú‚îÄ‚îÄ –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ 1
        ‚îÇ   ‚îî‚îÄ‚îÄ ...
        ‚îî‚îÄ‚îÄ ...
```

---

## –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–î–∞—Ç–∞:** 13.12.2024
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

### –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ proxy-–º–æ–¥–µ–ª—å `OrganizationKeyDeadline` (deadline_control/models/key_deadline.py:172-181)
2. ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–¥–µ–ª–∞–Ω –∞–¥–º–∏–Ω `OrganizationKeyDeadlineAdmin`:
   - –°–ø–∏—Å–æ–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –≤–º–µ—Å—Ç–æ —Å–ø–∏—Å–∫–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
   - –ò–Ω–ª–∞–π–Ω `KeyDeadlineItemInline` —Å–æ –≤—Å–µ–º–∏ —Ç—Ä–µ–±—É–µ–º—ã–º–∏ –ø–æ–ª—è–º–∏
   - –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ —Ç–∞–±–ª–∏—Ü–µ
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: —Å–Ω–∞—á–∞–ª–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Å –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–º–∏
3. ‚úÖ –£–±—Ä–∞–Ω –∏–Ω–ª–∞–π–Ω –∫–ª—é—á–µ–≤—ã—Ö —Å—Ä–æ–∫–æ–≤ –∏–∑ `OrganizationAdmin`
4. ‚úÖ –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏—Ä—É—é—â–∏–π —Ñ–∞–π–ª `organization_key_deadlines.py`
5. ‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ (`py manage.py check` - 0 –æ—à–∏–±–æ–∫)

### URL –Ω–æ–≤–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è:

`http://localhost:8001/admin/deadline_control/organizationkeydeadline/`

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–Ω–ª–∞–π–Ω–∞ (–∏—Ç–æ–≥–æ–≤–∞—è):

| –ü–æ–ª–µ | –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è |
|------|--------------|
| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –í—ã–±–æ—Ä –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ |
| –ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è | –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ |
| –î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è | –ö–∞–ª–µ–Ω–¥–∞—Ä—å |
| –î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (readonly) |
| –°—Ç–∞—Ç—É—Å | –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Å –¥–Ω—è–º–∏ (readonly) |
| –°—Ä–æ–∫ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è (–º–µ—Å—è—Ü–µ–≤) | –ß–∏—Å–ª–æ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é) |
| –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –ª–∏—Ü–æ | –¢–µ–∫—Å—Ç/email |
| –ê–∫—Ç–∏–≤–Ω–æ | Checkbox |

---

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:** 13.12.2024
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** `py manage.py check` - —É—Å–ø–µ—à–Ω–æ
