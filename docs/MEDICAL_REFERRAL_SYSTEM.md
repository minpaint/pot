# üè• –°–∏—Å—Ç–µ–º–∞ –≤—ã–¥–∞—á–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –æ—Å–º–æ—Ç—Ä

## –û–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

–°–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –æ—Å–º–æ—Ç—Ä –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ä–µ–¥–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –∏—Ö –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–∫—Ç –≤—ã–¥–∞—á–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

---

## üìã –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

### –ù–æ–≤–∞—è –º–æ–¥–µ–ª—å: `MedicalReferral` (–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –º–µ–¥–æ—Å–º–æ—Ç—Ä)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `deadline_control/models/medical_referral.py`

```python
class MedicalReferral(models.Model):
    """
    üìã –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –æ—Å–º–æ—Ç—Ä
    –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ñ–∞–∫—Ç –≤—ã–¥–∞—á–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É
    """
    employee = models.ForeignKey(
        'directory.Employee',
        on_delete=models.CASCADE,
        related_name="medical_referrals",
        verbose_name="–°–æ—Ç—Ä—É–¥–Ω–∏–∫"
    )

    # –î–∞–Ω–Ω—ã–µ –Ω–∞ –º–æ–º–µ–Ω—Ç –≤—ã–¥–∞—á–∏ (–º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç —Ç–µ–∫—É—â–∏—Ö)
    employee_birth_date = models.DateField(
        verbose_name="–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è",
        help_text="–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç –≤—ã–¥–∞—á–∏"
    )

    employee_address = models.TextField(
        verbose_name="–ú–µ—Å—Ç–æ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è",
        help_text="–ê–¥—Ä–µ—Å –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç –≤—ã–¥–∞—á–∏"
    )

    # –í—Ä–µ–¥–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã (M2M —á–µ—Ä–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—É—é –º–æ–¥–µ–ª—å)
    harmful_factors = models.ManyToManyField(
        'deadline_control.HarmfulFactor',
        related_name="referrals",
        verbose_name="–í—Ä–µ–¥–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã"
    )

    # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤—ã–¥–∞—á–∏
    issue_date = models.DateField(
        verbose_name="–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏",
        auto_now_add=True,
        help_text="–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è"
    )

    issued_by = models.ForeignKey(
        'auth.User',
        on_delete=models.SET_NULL,
        null=True,
        related_name="issued_referrals",
        verbose_name="–ö–µ–º –≤—ã–¥–∞–Ω–æ"
    )

    # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
    document = models.FileField(
        upload_to='medical_referrals/%Y/%m/',
        verbose_name="–î–æ–∫—É–º–µ–Ω—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è",
        blank=True,
        null=True
    )

    notes = models.TextField(
        verbose_name="–ü—Ä–∏–º–µ—á–∞–Ω–∏—è",
        blank=True
    )

    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        verbose_name = "–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –º–µ–¥–æ—Å–º–æ—Ç—Ä"
        verbose_name_plural = "–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –º–µ–¥–æ—Å–º–æ—Ç—Ä—ã"
        ordering = ['-issue_date', '-created_at']

    def __str__(self):
        return f"–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #{self.pk} - {self.employee} ({self.issue_date})"
```

---

## üñ•Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### 1. –ö–Ω–æ–ø–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –ü–∞–Ω–µ–ª—å –¥–µ–π—Å—Ç–≤–∏–π (sticky), —Ä—è–¥–æ–º —Å –∫–Ω–æ–ø–∫–æ–π "–î–æ–∫—É–º–µ–Ω—Ç—ã"

**–£—Å–ª–æ–≤–∏–µ –ø–æ—è–≤–ª–µ–Ω–∏—è:** –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ **–æ–¥–Ω–æ–≥–æ** —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≥–∞–ª–æ—á–∫–æ–π

**–í–Ω–µ—à–Ω–∏–π –≤–∏–¥:**
```html
<button id="btnMedicalReferral" class="btn btn-info btn-sm" style="display: none;">
    üè• <span class="d-none d-md-inline">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</span>
</button>
```

**–¶–≤–µ—Ç:** `btn-info` (–≥–æ–ª—É–±–æ–π) - –∞—Å—Å–æ—Ü–∏–∏—Ä—É–µ—Ç—Å—è —Å –º–µ–¥–∏—Ü–∏–Ω–æ–π

---

### 2. –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–¥–∞—á–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–ü–æ–ª—è —Ñ–æ—Ä–º—ã:**

| –ü–æ–ª–µ | –¢–∏–ø | –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|-----------------|----------|
| üë§ –§–ò–û | –¢–µ–∫—Å—Ç | ‚ùå –ó–∞–∫—Ä—ã—Ç–æ | –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ |
| üíº –î–æ–ª–∂–Ω–æ—Å—Ç—å | –¢–µ–∫—Å—Ç | ‚ùå –ó–∞–∫—Ä—ã—Ç–æ | –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ |
| üìÖ –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è | DateField | ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–µ | –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–æ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏, –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å |
| üè† –ú–µ—Å—Ç–æ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è | TextField | ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–µ | –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–æ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏, –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å |

**–ö–Ω–æ–ø–∫–∞:** `üè• –í—ã–¥–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ` (primary)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞:**
```html
<div class="modal" id="medicalReferralModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">üè• –í—ã–¥–∞—á–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –º–µ–¥–æ—Å–º–æ—Ç—Ä</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="referralForm">
                    <!-- üë§ –§–ò–û -->
                    <div class="mb-3">
                        <label class="form-label">üë§ –§–ò–û</label>
                        <input type="text" class="form-control" id="refEmployeeName" readonly>
                    </div>

                    <!-- üíº –î–æ–ª–∂–Ω–æ—Å—Ç—å -->
                    <div class="mb-3">
                        <label class="form-label">üíº –î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
                        <input type="text" class="form-control" id="refPosition" readonly>
                    </div>

                    <!-- üìÖ –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è -->
                    <div class="mb-3">
                        <label class="form-label">üìÖ –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                        <input type="date" class="form-control" id="refBirthDate" required>
                    </div>

                    <!-- üè† –ú–µ—Å—Ç–æ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è -->
                    <div class="mb-3">
                        <label class="form-label">üè† –ú–µ—Å—Ç–æ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è</label>
                        <textarea class="form-control" id="refAddress" rows="2" required></textarea>
                    </div>

                    <input type="hidden" id="refEmployeeId">
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-primary" id="btnGenerateReferral">
                    üè• –í—ã–¥–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                </button>
            </div>
        </div>
    </div>
</div>
```

---

## üîÑ Workflow

### –®–∞–≥ 1: –í—ã–±–æ—Ä —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å—Ç–∞–≤–∏—Ç –≥–∞–ª–æ—á–∫—É –Ω–∞–ø—Ä–æ—Ç–∏–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
2. –ü–æ—è–≤–ª—è–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "üè• –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ" —Ä—è–¥–æ–º —Å "–î–æ–∫—É–º–µ–Ω—Ç—ã"

### –®–∞–≥ 2: –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "üè• –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ"
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
3. –ü–æ–ª—è –§–ò–û –∏ –î–æ–ª–∂–Ω–æ—Å—Ç—å –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–Ω–µ—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–µ)
4. –ü–æ–ª—è –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è –∏ –ú–µ—Å—Ç–æ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω—ã –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞

### –®–∞–≥ 3: –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –î–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å/–¥–æ–ø–æ–ª–Ω–∏—Ç—å –ú–µ—Å—Ç–æ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è
3. –≠—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è **–æ–±–Ω–æ–≤–ª—è—é—Ç –∫–∞—Ä—Ç–æ—á–∫—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞** –≤ –±–∞–∑–µ

### –®–∞–≥ 4: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "üè• –í—ã–¥–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ"
2. –°–∏—Å—Ç–µ–º–∞:
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (–µ—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã)
   - –ü–æ–ª—É—á–∞–µ—Ç –≤—Ä–µ–¥–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã –∏–∑ `PositionMedicalFactor` –ø–æ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
   - –ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç DOCX –ø–æ —à–∞–±–ª–æ–Ω—É
   - –°–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å –≤ `MedicalReferral`
   - –°–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–∞–π–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

## üîå API Endpoints

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
```
GET /deadline-control/medical/referral/employee/{id}/
```

**–û—Ç–≤–µ—Ç:**
```json
{
    "id": 1,
    "full_name": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
    "position": "–≠–ª–µ–∫—Ç—Ä–æ–º–æ–Ω—Ç–µ—Ä",
    "birth_date": "1985-03-15",
    "address": "–≥. –ú–∏–Ω—Å–∫, —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10, –∫–≤. 5",
    "harmful_factors": [
        {"id": 1, "short_name": "3.4", "full_name": "–≠–ª–µ–∫—Ç—Ä–æ–º–∞–≥–Ω–∏—Ç–Ω—ã–µ –ø–æ–ª—è"}
    ]
}
```

### 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
```
POST /deadline-control/medical/referral/generate/
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
    "employee_id": 1,
    "birth_date": "1985-03-15",
    "address": "–≥. –ú–∏–Ω—Å–∫, —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10, –∫–≤. 5"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
    "success": true,
    "referral_id": 42,
    "document_url": "/media/medical_referrals/2025/11/referral_42.docx",
    "message": "–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ"
}
```

---

## üîÑ –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–¥–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤ (–í–ê–ñ–ù–û!)

### –ò–µ—Ä–∞—Ä—Ö–∏—è –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π:

```python
def get_harmful_factors_for_employee(employee):
    """
    –ü–æ–ª—É—á–∞–µ—Ç –≤—Ä–µ–¥–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ —Å —É—á—ë—Ç–æ–º –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π.

    –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
    1. –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã –¥–ª—è –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (PositionMedicalFactor)
    2. –≠—Ç–∞–ª–æ–Ω–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ (MedicalExaminationNorm)
    """
    position = employee.position

    # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–æ–ª–∂–Ω–æ—Å—Ç–∏
    overridden_factors = PositionMedicalFactor.objects.filter(
        position=position,
        is_disabled=False  # –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã
    ).select_related('harmful_factor')

    if overridden_factors.exists():
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã
        return [pf.harmful_factor for pf in overridden_factors]

    # 2. –ï—Å–ª–∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π –Ω–µ—Ç - –±–µ—Ä—ë–º —ç—Ç–∞–ª–æ–Ω–Ω—ã–µ –Ω–æ—Ä–º—ã –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –¥–æ–ª–∂–Ω–æ—Å—Ç–∏
    reference_norms = MedicalExaminationNorm.objects.filter(
        position_name=position.position_name
    ).select_related('harmful_factor')

    return [norm.harmful_factor for norm in reference_norms]
```

### –ü—Ä–∏–º–µ—Ä—ã:

**–ü—Ä–∏–º–µ—Ä 1: –î–æ–ª–∂–Ω–æ—Å—Ç—å –ë–ï–ó –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π**
- –î–æ–ª–∂–Ω–æ—Å—Ç—å: "–≠–ª–µ–∫—Ç—Ä–æ–º–æ–Ω—Ç–µ—Ä" –≤ –û–ê–û "–ë–µ–ª–∞–≤—Ç–æ"
- `PositionMedicalFactor` –¥–ª—è —ç—Ç–æ–π –¥–æ–ª–∂–Ω–æ—Å—Ç–∏: –ø—É—Å—Ç–æ
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –±–µ—Ä—ë–º –∏–∑ `MedicalExaminationNorm` –≥–¥–µ `position_name="–≠–ª–µ–∫—Ç—Ä–æ–º–æ–Ω—Ç–µ—Ä"`
  - –§–∞–∫—Ç–æ—Ä 3.4 (—ç–ª–µ–∫—Ç—Ä–æ–º–∞–≥–Ω–∏—Ç–Ω—ã–µ –ø–æ–ª—è)
  - –§–∞–∫—Ç–æ—Ä 4.1 (—Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏)

**–ü—Ä–∏–º–µ—Ä 2: –î–æ–ª–∂–Ω–æ—Å—Ç—å –° –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è–º–∏**
- –î–æ–ª–∂–Ω–æ—Å—Ç—å: "–≠–ª–µ–∫—Ç—Ä–æ–º–æ–Ω—Ç–µ—Ä" –≤ –û–û–û "–≠–ª–µ–∫—Ç—Ä–æ—Å–µ—Ç–∏"
- `PositionMedicalFactor` –¥–ª—è —ç—Ç–æ–π –¥–æ–ª–∂–Ω–æ—Å—Ç–∏:
  - –§–∞–∫—Ç–æ—Ä 3.4 (—ç–ª–µ–∫—Ç—Ä–æ–º–∞–≥–Ω–∏—Ç–Ω—ã–µ –ø–æ–ª—è) - –∞–∫—Ç–∏–≤–µ–Ω
  - –§–∞–∫—Ç–æ—Ä 5.1 (—Ä–∞–±–æ—Ç–∞ –Ω–∞ –≤—ã—Å–æ—Ç–µ) - –î–û–ë–ê–í–õ–ï–ù
  - –§–∞–∫—Ç–æ—Ä 4.1 - –ù–ï –î–û–ë–ê–í–õ–ï–ù (–æ—Ç–∫–ª—é—á—ë–Ω –≤ —ç—Ç–∞–ª–æ–Ω–µ)
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ
  - –§–∞–∫—Ç–æ—Ä 3.4
  - –§–∞–∫—Ç–æ—Ä 5.1

**–ü—Ä–∏–º–µ—Ä 3: –î–æ–ª–∂–Ω–æ—Å—Ç—å —Å –æ—Ç–∫–ª—é—á—ë–Ω–Ω—ã–º–∏ —Ñ–∞–∫—Ç–æ—Ä–∞–º–∏**
- `PositionMedicalFactor.is_disabled=True` –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ñ–∞–∫—Ç–æ—Ä –æ—Ç–∫–ª—é—á—ë–Ω
- –¢–∞–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã –ù–ï –≤–∫–ª—é—á–∞—é—Ç—Å—è –≤ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

---

## üìÅ –®–∞–±–ª–æ–Ω –¥–æ–∫—É–º–µ–Ω—Ç–∞

**–§–∞–π–ª:** `media/document_templates/etalon/napravlenie_blank.docx`

**–ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è:**

| –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä | –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö |
|-------------|-----------------|
| `{{ organization_name }}` | `Employee.organization.full_name_ru` |
| `{{ organization_name_by }}` | `Employee.organization.full_name_by` |
| `{{ organization_requisites }}` | `Employee.organization.requisites` (–Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ) |
| `{{ last_name }}` | `Employee.full_name_nominative` (—Ñ–∞–º–∏–ª–∏—è) |
| `{{ first_name }}` | `Employee.full_name_nominative` (–∏–º—è –æ—Ç—á–µ—Å—Ç–≤–æ) |
| `{{ date_of_birth }}` | –ò–∑ —Ñ–æ—Ä–º—ã (–º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω–æ) |
| `{{ address }}` | –ò–∑ —Ñ–æ—Ä–º—ã (–º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω–æ) |
| `{{ position_name }}` | `Employee.position.position_name` |
| `{{ harmful_factors }}` | **–ü–æ –∏–µ—Ä–∞—Ä—Ö–∏–∏**: —Å–Ω–∞—á–∞–ª–∞ `PositionMedicalFactor`, –µ—Å–ª–∏ –Ω–µ—Ç - `MedicalExaminationNorm` |
| `{{ issue_date }}` | –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞ |

---

## üîê –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

1. **–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ —Å–≤–æ–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π (—á–µ—Ä–µ–∑ `Profile.organizations`)
2. **Superuser** - –≤–∏–¥–∏—Ç –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
3. **–ó–∞–ø–∏—Å—å –≤ –∂—É—Ä–Ω–∞–ª** - –∫–∞–∂–¥–∞—è –≤—ã–¥–∞—á–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üìä –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å

### –†–∞–∑–¥–µ–ª: –ö–æ–Ω—Ç—Ä–æ–ª—å —Å—Ä–æ–∫–æ–≤ ‚Üí –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –º–µ–¥–æ—Å–º–æ—Ç—Ä—ã

**List Display:**
- –°–æ—Ç—Ä—É–¥–Ω–∏–∫
- –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è
- –î–∞—Ç–∞ –≤—ã–¥–∞—á–∏
- –ö–µ–º –≤—ã–¥–∞–Ω–æ
- –î–æ–∫—É–º–µ–Ω—Ç (—Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ)

**Filters:**
- –ü–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- –ü–æ –¥–∞—Ç–µ –≤—ã–¥–∞—á–∏
- –ü–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**Search:**
- –ü–æ –§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞

---

## üõ†Ô∏è –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥–µ–ª—è—Ö

### 1. `Organization` - –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤
```python
requisites = models.TextField(
    verbose_name="–†–µ–∫–≤–∏–∑–∏—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏",
    blank=True,
    help_text="–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å, –ò–ù–ù, –ö–ü–ü, –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –∏ —Ç.–¥."
)
```

### 2. `Employee` - –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –∞–¥—Ä–µ—Å–∞ (–µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)
```python
address = models.TextField(
    verbose_name="–ú–µ—Å—Ç–æ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è",
    blank=True,
    help_text="–ê–¥—Ä–µ—Å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞"
)
```

---

## üìù –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
deadline_control/
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ medical_referral.py          # –ù–æ–≤–∞—è –º–æ–¥–µ–ª—å
‚îú‚îÄ‚îÄ views/
‚îÇ   ‚îî‚îÄ‚îÄ medical_referral.py          # Views –¥–ª—è API
‚îú‚îÄ‚îÄ admin/
‚îÇ   ‚îî‚îÄ‚îÄ medical_referral.py          # –ê–¥–º–∏–Ω–∫–∞
‚îî‚îÄ‚îÄ urls.py                           # –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã

directory/
‚îî‚îÄ‚îÄ templates/
    ‚îî‚îÄ‚îÄ directory/
        ‚îî‚îÄ‚îÄ home.html                 # –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –∫–Ω–æ–ø–∫—É

static/
‚îî‚îÄ‚îÄ directory/
    ‚îî‚îÄ‚îÄ js/
        ‚îî‚îÄ‚îÄ medical_referral.js       # JavaScript –ª–æ–≥–∏–∫–∞
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. [ ] –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å `MedicalReferral`
2. [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `address` –≤ –º–æ–¥–µ–ª—å `Employee`
3. [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `requisites` –≤ –º–æ–¥–µ–ª—å `Organization`
4. [ ] –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
5. [ ] –°–æ–∑–¥–∞—Ç—å View –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (AJAX)
6. [ ] –°–æ–∑–¥–∞—Ç—å View –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
7. [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "üè• –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ" –≤ `home.html`
8. [ ] –°–æ–∑–¥–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤ `home.html`
9. [ ] –ù–∞–ø–∏—Å–∞—Ç—å JavaScript –¥–ª—è –ª–æ–≥–∏–∫–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
10. [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —à–∞–±–ª–æ–Ω DOCX –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
11. [ ] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å –≤ –∞–¥–º–∏–Ω–∫–µ
12. [ ] –î–æ–±–∞–≤–∏—Ç—å URL –º–∞—Ä—à—Ä—É—Ç—ã
13. [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
