# TODO: HTML –®–∞–±–ª–æ–Ω—ã –¥–ª—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ

1. **–°–æ–∑–¥–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** `create_medical_template.py`
   - –°–æ–∑–¥–∞–µ—Ç —Ç–∏–ø —à–∞–±–ª–æ–Ω–∞ `medical_examination`
   - –°–æ–∑–¥–∞–µ—Ç HTML —à–∞–±–ª–æ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
   - –®–∞–±–ª–æ–Ω –≤–∫–ª—é—á–∞–µ—Ç —ç–º–æ–¥–∑–∏, —Ü–≤–µ—Ç–æ–≤—ã–µ —Å–µ–∫—Ü–∏–∏, –∫–Ω–æ–ø–∫—É "–í—ã–¥–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è"

2. **–û–±–Ω–æ–≤–ª–µ–Ω EmailTemplate –º–æ–¥–µ–ª—å**
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —Ñ–∏–≥—É—Ä–Ω—ã—Ö —Å–∫–æ–±–∫–∞—Ö
   - –ú–µ—Ç–æ–¥—ã `get_formatted_subject()` –∏ `get_formatted_body()`

3. **–û–±–Ω–æ–≤–ª–µ–Ω MedicalSettingsAdmin** (`deadline_control/admin/medical_examination.py`)
   - –ú–µ—Ç–æ–¥ `send_medical_notification()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç HTML —à–∞–±–ª–æ–Ω
   - –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `_format_html_section()` –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è HTML —Å–ø–∏—Å–∫–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
   - –ü–æ—Ä—è–¥–æ–∫ —Å–µ–∫—Ü–∏–π: **–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ** ‚Üí **–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ** ‚Üí **–ë–µ–∑ –¥–∞—Ç—ã**
   - –ö–Ω–æ–ø–∫–∞ "üìã –í—ã–¥–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è" –≤–µ–¥–µ—Ç –Ω–∞ `/deadline-control/medical/`
   - –¢–µ–∫—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –ø–∏—Å—å–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ fallback

4. **–ß–∞—Å—Ç–∏—á–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞** `send_medical_notifications.py`
   - –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è HTML —à–∞–±–ª–æ–Ω–∞
   - –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `_format_html_section()` (–Ω–æ —Å–∞–º –º–µ—Ç–æ–¥ –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω!)

5. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ñ–∏–ª—å—Ç—Ä—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤**
   - –¢–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∞—é—Ç—Å—è –í–°–ï —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ —Ç–µ, —É –∫–æ–≥–æ –µ—Å—Ç—å –º–µ–¥–æ—Å–º–æ—Ç—Ä—ã
   - –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –±–µ–∑ –¥–∞—Ç—ã –º–µ–¥–æ—Å–º–æ—Ç—Ä–∞

## ‚ùå –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å

### 1. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `_format_html_section` –≤ –∫–æ–º–∞–Ω–¥—É
**–§–∞–π–ª:** `deadline_control/management/commands/send_medical_notifications.py`

**–ì–¥–µ:** –ü–æ—Å–ª–µ –º–µ—Ç–æ–¥–∞ `_format_email_message()` (—Å—Ç—Ä–æ–∫–∞ ~417)

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å:** –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `_format_html_section()` –∏–∑ `medical_examination.py:558-644`

```python
def _format_html_section(self, employees_data, section_type):
    """
    –§–æ—Ä–º–∏—Ä—É–µ—Ç HTML —Å–µ–∫—Ü–∏—é –¥–ª—è —Å–ø–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.

    Args:
        employees_data: —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
        section_type: —Ç–∏–ø —Å–µ–∫—Ü–∏–∏ ('overdue', 'upcoming', 'no_date')

    Returns:
        str: HTML –∫–æ–¥ —Å–µ–∫—Ü–∏–∏
    """
    # ... —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å –∫–æ–¥ –∏–∑ medical_examination.py
```

### 2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

**–ö–∞–∫:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä: `py manage.py runserver 8001`
2. –û—Ç–∫—Ä—ã—Ç—å `/admin/deadline_control/medicalsettings/`
3. –ù–∞–π—Ç–∏ "–û–û–û –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ü–ª—é—Å"
4. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "üìß –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–∏—Å—å–º–æ –ø—Ä–∏—à–ª–æ –Ω–∞ `minpaint@yandex.ru`
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTML –≤–µ—Ä—Å—Ç–∫—É –ø–∏—Å—å–º–∞
7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–Ω–æ–ø–∫–∞ "–í—ã–¥–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è" —Ä–∞–±–æ—Ç–∞–µ—Ç

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü–∏—Å—å–º–æ —Å HTML –≤–µ—Ä—Å—Ç–∫–æ–π
- –°–µ–∫—Ü–∏–∏ –≤ –ø–æ—Ä—è–¥–∫–µ: –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ ‚Üí –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ ‚Üí –ë–µ–∑ –¥–∞—Ç—ã
- –≠–º–æ–¥–∑–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ö–Ω–æ–ø–∫–∞ –∑–µ–ª–µ–Ω–∞—è, –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞—è, –≤–µ–¥–µ—Ç –Ω–∞ `/deadline-control/medical/`
- –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤—Å–µ 12 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –±–µ–∑ –¥–∞—Ç—ã (–Ω–µ 1!)

### 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É

**–ö–∞–∫:**
```bash
py manage.py send_medical_notifications
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- –ü–∏—Å—å–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
- HTML —à–∞–±–ª–æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### 4. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

**–§–∞–π–ª—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**

**`docs/EMAIL_SYSTEM.md`**
- –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª "HTML –®–∞–±–ª–æ–Ω—ã" —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Å–∏—Å—Ç–µ–º—ã —à–∞–±–ª–æ–Ω–æ–≤
- –û–ø–∏—Å–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —à–∞–±–ª–æ–Ω–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –æ—Å–º–æ—Ç—Ä–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- –û–ø–∏—Å–∞—Ç—å –∫–∞–∫ —Å–æ–∑–¥–∞–≤–∞—Ç—å/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω—ã —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É

**`docs/NOTIFICATION_BUTTONS_GUIDE.md`**
- –û–±–Ω–æ–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª –ø—Ä–æ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ HTML –≤–µ—Ä—Å–∏–∏ –ø–∏—Å—å–º–∞
- –û–ø–∏—Å–∞—Ç—å –∫–Ω–æ–ø–∫—É "–í—ã–¥–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è"

### 5. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è EmailTemplateType (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```bash
py manage.py showmigrations deadline_control
```

–ï—Å–ª–∏ —Ç–∏–ø–∞ —à–∞–±–ª–æ–Ω–∞ `medical_examination` –Ω–µ—Ç –≤ –º–∏–≥—Ä–∞—Ü–∏—è—Ö - —Å–æ–∑–¥–∞—Ç—å:
```bash
py manage.py makemigrations deadline_control --name add_medical_template_type
```

### 6. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∫—É –¥–ª—è EmailTemplate

**–§–∞–π–ª:** `deadline_control/admin/email_template.py`

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å:**
- –ê–¥–º–∏–Ω–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤
- –§–∏–ª—å—Ç—Ä—ã –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏ —Ç–∏–ø—É —à–∞–±–ª–æ–Ω–∞
- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —à–∞–±–ª–æ–Ω–∞ —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –ö–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ"

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ HTML —à–∞–±–ª–æ–Ω–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:
- `{organization_name}` - –∫—Ä–∞—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- `{overdue_count}` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö
- `{upcoming_count}` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö
- `{no_date_count}` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–µ–∑ –¥–∞—Ç—ã
- `{overdue_section}` - HTML —Å–µ–∫—Ü–∏—è –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö
- `{upcoming_section}` - HTML —Å–µ–∫—Ü–∏—è –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö
- `{no_date_section}` - HTML —Å–µ–∫—Ü–∏—è –±–µ–∑ –¥–∞—Ç—ã
- `{medical_url}` - —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –º–µ–¥–æ—Å–º–æ—Ç—Ä–æ–≤

### –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞:
- **–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ**: –∫—Ä–∞—Å–Ω—ã–π (#f44336)
- **–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ**: –æ—Ä–∞–Ω–∂–µ–≤—ã–π (#ff9800)
- **–ë–µ–∑ –¥–∞—Ç—ã**: —Å–∏–Ω–∏–π (#2196f3)
- **–ö–Ω–æ–ø–∫–∞ "–í—ã–¥–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è"**: –∑–µ–ª–µ–Ω—ã–π (#4caf50)

### –ö–Ω–æ–ø–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è:
```html
<a href="{medical_url}" style="display: inline-block; background-color: #4caf50; color: white; padding: 15px 40px; text-decoration: none; border-radius: 8px; font-size: 16px; font-weight: 600;">
    üìã –í—ã–¥–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
</a>
```

## üîß –§–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã

1. `deadline_control/management/commands/create_medical_template.py` (–Ω–æ–≤—ã–π)
2. `deadline_control/admin/medical_examination.py` (–æ–±–Ω–æ–≤–ª–µ–Ω)
3. `deadline_control/management/commands/send_medical_notifications.py` (—á–∞—Å—Ç–∏—á–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω)
4. `deadline_control/models/email_template.py` (—É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª)
5. `deadline_control/models/email_settings.py` (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω IDNA –±–∞–≥)
6. `deadline_control/admin/email_settings.py` (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–¢–µ—Å—Ç email")

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **IDNA –æ—à–∏–±–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞** - –¥–æ–±–∞–≤–ª–µ–Ω –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ø–∞—Ç—á `socket.getfqdn()` –≤ `email_settings.py`
2. **–§–∏–ª—å—Ç—Ä—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã** - —Ç–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∞—é—Ç—Å—è –í–°–ï —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏, –≤–∫–ª—é—á–∞—è –±–µ–∑ –º–µ–¥–æ—Å–º–æ—Ç—Ä–æ–≤
3. **–ö–Ω–æ–ø–∫–∏ –≤ –∞–¥–º–∏–Ω–∫–µ —Ä–∞–±–æ—Ç–∞—é—Ç** - –∏—Å–ø–æ–ª—å–∑—É—é—Ç `change_view()` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ GET –∑–∞–ø—Ä–æ—Å–æ–≤
4. **–î–≤–æ–π–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø–∏—Å–µ–º** - —Ç–µ–∫—Å—Ç–æ–≤–∞—è (fallback) + HTML (–æ—Å–Ω–æ–≤–Ω–∞—è)

## üìÖ –°–ª–µ–¥—É—é—â–∞—è —Å–µ—Å—Å–∏—è

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1:** –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `_format_html_section` –≤ –∫–æ–º–∞–Ω–¥—É
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∏—Å—å–º–æ
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3:** –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

**–î–∞—Ç–∞:** 09.12.2025
