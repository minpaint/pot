{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}–û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: {{ category.name }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">–ì–ª–∞–≤–Ω–∞—è</a>
    &rsaquo; <a href="{% url 'admin:app_list' app_label='deadline_control' %}">–ö–æ–Ω—Ç—Ä–æ–ª—å —Å—Ä–æ–∫–æ–≤</a>
    &rsaquo; <a href="{% url 'admin:deadline_control_keydeadlinecategory_changelist' %}">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–ª—é—á–µ–≤—ã—Ö —Å—Ä–æ–∫–æ–≤</a>
    &rsaquo; –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: {{ category.name }}
</div>
{% endblock %}

{% block content %}
<div class="module">
    <h1>‚öôÔ∏è –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è—Ö</h1>

    <fieldset class="module aligned">
        <h2>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
        <div style="padding: 15px;">
            <p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> {{ category.name }}</p>
            <p><strong>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è:</strong> {{ category.organization.full_name_ru }}</p>
            {% if category.description %}
            <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ category.description }}</p>
            {% endif %}
        </div>
    </fieldset>

    <fieldset class="module aligned">
        <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</h2>
        <div style="padding: 15px;">
            <table style="width: 100%; border-collapse: collapse;">
                <tr>
                    <td style="padding: 8px; border: 1px solid #ddd;">
                        <strong>üö® –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö:</strong>
                    </td>
                    <td style="padding: 8px; border: 1px solid #ddd;">
                        <span style="color: #f44336; font-weight: bold; font-size: 16px;">{{ overdue_items|length }}</span>
                    </td>
                </tr>
                <tr>
                    <td style="padding: 8px; border: 1px solid #ddd;">
                        <strong>‚è∞ –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö (30 –¥–Ω–µ–π):</strong>
                    </td>
                    <td style="padding: 8px; border: 1px solid #ddd;">
                        <span style="color: #ff9800; font-weight: bold; font-size: 16px;">{{ upcoming_items_30|length }}</span>
                    </td>
                </tr>
                <tr>
                    <td style="padding: 8px; border: 1px solid #ddd;">
                        <strong>‚è∞ –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö (60 –¥–Ω–µ–π):</strong>
                    </td>
                    <td style="padding: 8px; border: 1px solid #ddd;">
                        <span style="color: #2196f3; font-weight: bold; font-size: 16px;">{{ upcoming_items_60|length }}</span>
                    </td>
                </tr>
            </table>

            {% if not overdue_items and not upcoming_items_30 %}
            <div style="background-color: #d4edda; padding: 15px; border-left: 4px solid #28a745; margin-top: 15px;">
                <strong>‚úÖ –ù–µ—Ç –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∏–ª–∏ —Å—Ä–æ—á–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</strong>
                <p>–í –¥–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ—Ç –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π, —Ç—Ä–µ–±—É—é—â–∏—Ö —Å—Ä–æ—á–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è.</p>
            </div>
            {% endif %}
        </div>
    </fieldset>

    {% if overdue_items or upcoming_items_30 or upcoming_items_60 %}
    <form method="post" style="margin-top: 20px;">
        {% csrf_token %}

        <fieldset class="module aligned">
            <h2>‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç–ø—Ä–∞–≤–∫–∏</h2>

            <div class="form-row">
                <div>
                    <label for="warning_days" class="required">–ü–µ—Ä–∏–æ–¥ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (–¥–Ω–µ–π):</label>
                    <input type="number" id="warning_days" name="warning_days" value="30" min="1" max="365" required>
                    <p class="help">
                        –ó–∞ —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –¥–æ –Ω–∞—Å—Ç—É–ø–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ<br>
                        <strong>–¢–µ–∫—É—â–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è:</strong><br>
                        ‚Ä¢ 30 –¥–Ω–µ–π: {{ upcoming_items_30|length }} –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π<br>
                        ‚Ä¢ 60 –¥–Ω–µ–π: {{ upcoming_items_60|length }} –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
                    </p>
                </div>
            </div>

            <div class="form-row">
                <div>
                    <label for="test_mode">
                        <input type="checkbox" id="test_mode" name="test_mode">
                        –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º
                    </label>
                    <p class="help">–û—Ç–º–µ—Ç—å—Ç–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã–µ –∞–¥—Ä–µ—Å–∞ –≤–º–µ—Å—Ç–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π</p>
                </div>
            </div>

            <div class="form-row" id="test_emails_row" style="display: none;">
                <div>
                    <label for="test_emails">Email –∞–¥—Ä–µ—Å–∞ –¥–ª—è —Ç–µ—Å—Ç–∞:</label>
                    <input type="text" id="test_emails" name="test_emails" size="60"
                           placeholder="email1@example.com, email2@example.com">
                    <p class="help">–£–∫–∞–∂–∏—Ç–µ email –∞–¥—Ä–µ—Å–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏</p>
                </div>
            </div>
        </fieldset>

        <div class="help" style="background-color: #e3f2fd; padding: 15px; border-left: 4px solid #2196f3; margin: 20px 0;">
            <h3>‚ÑπÔ∏è –ü–æ–ª—É—á–∞—Ç–µ–ª–∏</h3>
            <p>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ email –∞–¥—Ä–µ—Å–∞, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –≤ <strong>EmailSettings</strong> –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ <strong>{{ category.organization.short_name_ru }}</strong></p>
        </div>

        <div class="help" style="background-color: #fff3cd; padding: 15px; border-left: 4px solid #ffc107; margin: 20px 0;">
            <h3>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!</h3>
            <ul>
                <li>–ë—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø–æ <strong>—ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</strong>: "{{ category.name }}"</li>
                <li>–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ <strong>EmailSettings</strong></li>
                <li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É–∫–∞–∑–∞–Ω—ã –ø–æ–ª—É—á–∞—Ç–µ–ª–∏ –∏ SMTP —Å–µ—Ä–≤–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ</li>
            </ul>
        </div>

        <div class="submit-row">
            <input type="submit" value="üìß –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ" class="default">
            <a href="{% url 'admin:deadline_control_keydeadlinecategory_changelist' %}" class="button">–û—Ç–º–µ–Ω–∞</a>
        </div>
    </form>
    {% else %}
    <div class="submit-row">
        <a href="{% url 'admin:deadline_control_keydeadlinecategory_changelist' %}" class="button">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É</a>
    </div>
    {% endif %}
</div>

<script>
// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö email –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —á–µ–∫–±–æ–∫—Å–∞
document.getElementById('test_mode').addEventListener('change', function() {
    var testEmailsRow = document.getElementById('test_emails_row');
    if (this.checked) {
        testEmailsRow.style.display = 'block';
    } else {
        testEmailsRow.style.display = 'none';
    }
});
</script>
{% endblock %}
