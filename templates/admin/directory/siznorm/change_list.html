{% extends "admin/change_list.html" %}
{#
    –®–∞–±–ª–æ–Ω –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥—Ä–µ–≤–æ–≤–∏–¥–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –Ω–æ—Ä–º –°–ò–ó (–°—Ä–µ–¥—Å—Ç–≤ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –ó–∞—â–∏—Ç—ã).
    –û—Ä–≥–∞–Ω–∏–∑—É–µ—Ç –Ω–æ—Ä–º—ã –ø–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏—è–º/–¥–æ–ª–∂–Ω–æ—Å—Ç—è–º, –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –ø–æ —É—Å–ª–æ–≤–∏—è–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è.
    –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞: –ø—Ä–æ—Ñ–µ—Å—Å–∏—è ‚Üí —É—Å–ª–æ–≤–∏—è ‚Üí –Ω–æ—Ä–º—ã –°–ò–ó, –±–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
    –æ–± –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è—Ö –∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞—Ö –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π.
#}

{% load static %}

{% block content %}
<div id="content-main">
    <div class="object-tools">
        <a href="{% url 'admin:directory_siznorm_add' %}" class="addlink">
            –î–æ–±–∞–≤–∏—Ç—å –Ω–æ—Ä–º—É –°–ò–ó
        </a>
        <a href="{% url 'admin:directory_siz_add' %}" class="addlink">
            –î–æ–±–∞–≤–∏—Ç—å –°–ò–ó
        </a>
    </div>

    <form id="changelist-form" method="post"
        {% if cl.formset and cl.formset.is_multipart %} enctype="multipart/form-data"{% endif %}
        novalidate>
        {% csrf_token %}
        {% if action_form and actions_on_top and cl.show_admin_actions %}
        <div class="actions">
            {% for field in action_form %}
                {% if field.label %}<label>{{ field.label }}</label>{% endif %}
                {{ field }}
            {% endfor %}
            <button type="submit" class="button" title="–í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
            <span class="action-counter" style="display: none;">0 –∏–∑ {{ cl.result_count }} –≤—ã–±—Ä–∞–Ω–æ</span>
        </div>
        {% endif %}

        <div class="tree-controls">
            <button type="button" class="tree-btn expand-all">‚Üì –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ</button>
            <button type="button" class="tree-btn collapse-all">‚Üë –°–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ</button>
            <div class="tree-search-container">
                <input type="text" class="tree-search" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ —Å–ø–∏—Å–∫—É...">
            </div>
        </div>

        <div class="results">
            <table id="result_list">
                <thead>
                    <tr>
                        <th class="column-checkbox"><input type="checkbox" id="select-all"></th>
                        <th class="column-name">–ü–†–û–§–ï–°–°–ò–Ø/–î–û–õ–ñ–ù–û–°–¢–¨</th>
                        <th class="column-roles">–ò–ù–§–û–†–ú–ê–¶–ò–Ø</th>
                        <th class="column-actions">–î–ï–ô–°–¢–í–ò–Ø</th>
                    </tr>
                </thead>
                <tbody>
                {% for profession in professions %}
                    <tr class="tree-row" data-level="0" data-node-id="profession_{{ forloop.counter }}">
                        <td class="field-checkbox"></td>
                        <td class="field-name">
                            <button type="button" class="toggle-btn" data-state="expanded">[-]</button>
                            <span class="tree-icon">üëî</span>
                            <strong>{{ profession.name }}</strong>
                        </td>
                        <td class="field-roles">{{ profession.positions|length }} —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤</td>
                        <td class="field-actions">
                            <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ—Ä–º –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ -->
                            {% for position in profession.positions %}
                                {% if forloop.first %}
                                    <a href="{% url 'admin:directory_siznorm_add' %}?position={{ position.id }}"
                                       class="add-link" title="–î–æ–±–∞–≤–∏—Ç—å –Ω–æ—Ä–º—É –°–ò–ó">+</a>
                                {% endif %}
                            {% endfor %}
                        </td>
                    </tr>

                    {% if profession.base_norms or profession.group_norms %}
                        <!-- –ï–¥–∏–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –≤—Å–µ—Ö –Ω–æ—Ä–º –°–ò–ó –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ -->
                        <tr class="tree-row" data-level="1" data-parent-id="profession_{{ forloop.counter }}">
                            <td colspan="4" style="padding:0">
                                <table class="table table-bordered table-striped" style="width:100%">
                                    <thead>
                                        <tr>
                                            <th>–ù–ê–ò–ú–ï–ù–û–í–ê–ù–ò–ï –°–ò–ó</th>
                                            <th>–ö–õ–ê–°–°–ò–§–ò–ö–ê–¶–ò–Ø (–ú–ê–†–ö–ò–†–û–í–ö–ê)</th>
                                            <th>–ï–î. –ò–ó–ú.</th>
                                            <th>–ö–û–õ-–í–û</th>
                                            <th>–°–†–û–ö –ù–û–°–ö–ò</th>
                                            <th>–î–ï–ô–°–¢–í–ò–Ø</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% if profession.base_norms %}
                                            <!-- –ë–∞–∑–æ–≤—ã–µ –Ω–æ—Ä–º—ã –±–µ–∑ —É—Å–ª–æ–≤–∏–π -->
                                            {% for norm in profession.base_norms %}
                                            <tr>
                                                <td>{{ norm.siz.name }}</td>
                                                <td>{{ norm.siz.classification }}</td>
                                                <td>{{ norm.siz.unit }}</td>
                                                <td>{{ norm.quantity }}</td>
                                                <td>{% if norm.siz.wear_period == 0 %}–î–æ –∏–∑–Ω–æ—Å–∞{% else %}{{ norm.siz.wear_period }} –º–µ—Å.{% endif %}</td>
                                                <td>
                                                    <a href="{% url 'admin:directory_siznorm_change' norm.id %}" class="edit-link">‚úèÔ∏è</a>
                                                    <a href="{% url 'admin:directory_siznorm_delete' norm.id %}" class="delete-link">üóëÔ∏è</a>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        {% endif %}

                                        <!-- –ù–æ—Ä–º—ã –°–ò–ó –ø–æ —É—Å–ª–æ–≤–∏—è–º -->
                                        {% for group in profession.group_norms %}
                                            <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É—Å–ª–æ–≤–∏—è -->
                                            <tr style="background-color: #f0f0f0;">
                                                <td colspan="6" style="padding: 8px; font-weight: bold;">
                                                    <span class="tree-icon">üîç</span>
                                                    {{ group.name }} <span style="color: #666; font-weight: normal;">({{ group.norms|length }} –ø–æ–∑–∏—Ü–∏–π)</span>
                                                </td>
                                            </tr>
                                            <!-- –ù–æ—Ä–º—ã –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —É—Å–ª–æ–≤–∏—è -->
                                            {% for norm in group.norms %}
                                            <tr>
                                                <td>{{ norm.siz.name }}</td>
                                                <td>{{ norm.siz.classification }}</td>
                                                <td>{{ norm.siz.unit }}</td>
                                                <td>{{ norm.quantity }}</td>
                                                <td>{% if norm.siz.wear_period == 0 %}–î–æ –∏–∑–Ω–æ—Å–∞{% else %}{{ norm.siz.wear_period }} –º–µ—Å.{% endif %}</td>
                                                <td>
                                                    <a href="{% url 'admin:directory_siznorm_change' norm.id %}" class="edit-link">‚úèÔ∏è</a>
                                                    <a href="{% url 'admin:directory_siznorm_delete' norm.id %}" class="delete-link">üóëÔ∏è</a>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </td>
                        </tr>
                    {% endif %}
                {% endfor %}
                </tbody>
            </table>
        </div>
    </form>
</div>

{% endblock %}

{% block extrahead %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'admin/css/tree_view.css' %}">
    <script src="{% static 'admin/js/tree_view.js' %}"></script>
    <script src="{% static 'admin/js/tree_search.js' %}"></script>
{% endblock %}