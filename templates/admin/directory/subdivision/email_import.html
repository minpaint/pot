{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block extrahead %}
{{ block.super }}
<style>
    .import-form {
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .instruction-box {
        background: #e7f3ff;
        border-left: 4px solid #2196F3;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 4px;
    }
    .instruction-box h3 {
        margin-top: 0;
        color: #1976D2;
    }
    .instruction-box ul {
        margin: 10px 0;
        padding-left: 20px;
    }
    .instruction-box code {
        background: #f5f5f5;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: monospace;
    }
    .file-upload-area {
        border: 2px dashed #ccc;
        border-radius: 8px;
        padding: 30px;
        text-align: center;
        margin: 20px 0;
        background: #fafafa;
    }
    .file-upload-area:hover {
        border-color: #2196F3;
        background: #f5f9ff;
    }
    .submit-buttons {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }
    .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
    }
    .btn-primary {
        background: #417690;
        color: white;
    }
    .btn-primary:hover {
        background: #356a80;
    }
    .btn-secondary {
        background: #6c757d;
        color: white;
    }
    .btn-secondary:hover {
        background: #5a6268;
    }
    .error-list {
        background: #ffebee;
        border-left: 4px solid #f44336;
        padding: 15px;
        margin: 20px 0;
        border-radius: 4px;
    }
    .error-list h3 {
        margin-top: 0;
        color: #c62828;
    }
    .error-item {
        margin: 5px 0;
        color: #d32f2f;
    }
    .summary-box {
        background: #e8f5e9;
        border-left: 4px solid #4caf50;
        padding: 15px;
        margin: 20px 0;
        border-radius: 4px;
    }
    .summary-box h3 {
        margin-top: 0;
        color: #2e7d32;
    }
</style>
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">–ì–ª–∞–≤–Ω–∞—è</a>
    &rsaquo; <a href="{% url 'admin:directory_structuralsubdivision_changelist' %}">–°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è</a>
    &rsaquo; –ò–º–ø–æ—Ä—Ç Email
</div>
{% endblock %}

{% block content %}
<div class="import-form">
    <h1>üì• {{ title }}</h1>

    {% if selected_org_id != 'all' %}
    <div style="background: #e8f5e9; border-left: 4px solid #4caf50; padding: 15px; margin-bottom: 20px; border-radius: 4px;">
        <strong>üè¢ –í—ã–±—Ä–∞–Ω–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è:</strong> {{ selected_org_name }}
    </div>
    {% else %}
    <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin-bottom: 20px; border-radius: 4px;">
        <strong>üè¢ –†–µ–∂–∏–º:</strong> –ò–º–ø–æ—Ä—Ç –¥–ª—è –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
    </div>
    {% endif %}

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}" style="padding: 10px; margin: 10px 0; border-radius: 4px;
                {% if message.tags == 'error' %}background: #ffebee; color: #c62828; border-left: 4px solid #f44336;{% endif %}
                {% if message.tags == 'success' %}background: #e8f5e9; color: #2e7d32; border-left: 4px solid #4caf50;{% endif %}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <div class="instruction-box">
        <h3>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</h3>
        <p><strong>–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞:</strong> XLS –∏–ª–∏ XLSX —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏:</p>
        <ul>
            <li><code>target_level</code> - —É—Ä–æ–≤–µ–Ω—å (organization / subdivision / department)</li>
            <li><code>org_short_name</code> - –∫—Ä–∞—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏</li>
            <li><code>subdivision_name</code> - –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è (–¥–ª—è subdivision/department)</li>
            <li><code>department_name</code> - –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª–∞ (–¥–ª—è department)</li>
            <li><code>email</code> - email –∞–¥—Ä–µ—Å</li>
            <li><code>description</code> - –æ–ø–∏—Å–∞–Ω–∏–µ (—Ä–æ–ª—å, –¥–æ–ª–∂–Ω–æ—Å—Ç—å)</li>
            <li><code>is_active</code> - –∞–∫—Ç–∏–≤–µ–Ω (1/true/–¥–∞ –∏–ª–∏ 0/false/–Ω–µ—Ç)</li>
        </ul>
        <p><strong>–õ–æ–≥–∏–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:</strong></p>
        <ul>
            <li><strong>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:</strong> –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω—è—é—Ç —Å–ø–∏—Å–æ–∫ <code>recipient_emails</code> –≤ EmailSettings</li>
            <li><strong>–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è/–û—Ç–¥–µ–ª—ã:</strong> –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç —Å–ø–∏—Å–æ–∫ –∞–¥—Ä–µ—Å–æ–≤ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞</li>
            <li><strong>–ü—É—Å—Ç–æ–π email:</strong> –æ—á–∏—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∞–¥—Ä–µ—Å–æ–≤ –¥–ª—è –æ–±—ä–µ–∫—Ç–∞</li>
        </ul>
        <p><strong>–ü–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π:</strong></p>
        <ol>
            <li>–°–Ω–∞—á–∞–ª–∞ –Ω–∞–∂–º–∏—Ç–µ <strong>"–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª"</strong> (–±–µ–∑ –≥–∞–ª–æ—á–∫–∏) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏</li>
            <li>–ï—Å–ª–∏ –æ—à–∏–±–æ–∫ –Ω–µ—Ç, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≥–∞–ª–æ—á–∫—É <strong>"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è"</strong> –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–Ω–æ–≤–∞</li>
        </ol>
    </div>

    {% if errors %}
    <div class="error-list">
        <h3>‚ùå –ù–∞–π–¥–µ–Ω—ã –æ—à–∏–±–∫–∏ ({{ errors|length }})</h3>
        {% for row_num, error_msg in errors %}
        <div class="error-item">–°—Ç—Ä–æ–∫–∞ {{ row_num }}: {{ error_msg }}</div>
        {% endfor %}
    </div>
    {% endif %}

    {% if summary %}
    <div class="summary-box">
        <h3>‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏</h3>
        <p>
            <strong>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π:</strong> {{ summary.organizations }}<br>
            <strong>–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π:</strong> {{ summary.subdivisions }}<br>
            <strong>–û—Ç–¥–µ–ª–æ–≤:</strong> {{ summary.departments }}
        </p>
        {% if not apply_changes %}
        <p style="color: #f57c00; font-weight: bold;">
            ‚ö†Ô∏è –≠—Ç–æ —Ä–µ–∂–∏–º –ø—Ä–æ–≤–µ—Ä–∫–∏! –ò–∑–º–µ–Ω–µ–Ω–∏—è –ù–ï —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã.<br>
            –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≥–∞–ª–æ—á–∫—É "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è" –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª —Å–Ω–æ–≤–∞ –¥–ª—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞.
        </p>
        {% endif %}
    </div>
    {% endif %}

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="file-upload-area">
            <input type="file" name="import_file" accept=".xls,.xlsx" required style="margin: 10px 0;">
            <p style="color: #666; margin: 10px 0;">–í—ã–±–µ—Ä–∏—Ç–µ XLS –∏–ª–∏ XLSX —Ñ–∞–π–ª –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞</p>
        </div>

        <div style="margin: 20px 0;">
            <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="checkbox" name="apply" value="1" style="margin-right: 10px;">
                <strong>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î</strong>
                <span style="margin-left: 10px; color: #666;">(–±–µ–∑ –≥–∞–ª–æ—á–∫–∏ - —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∞)</span>
            </label>
        </div>

        <div class="submit-buttons">
            <button type="submit" class="btn btn-primary">
                üì§ {% if apply_changes %}–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å{% else %}–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª{% endif %}
            </button>
            <a href="{% url 'admin:directory_structuralsubdivision_changelist' %}" class="btn btn-secondary">
                ‚Üê –û—Ç–º–µ–Ω–∞
            </a>
        </div>
    </form>

    <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd;">
        <p style="color: #666;">
            <strong>üí° –°–æ–≤–µ—Ç:</strong> –í–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞
            <a href="{% url 'admin:directory_structuralsubdivision_email_manage' %}">—Å—Ç—Ä–∞–Ω–∏—Ü—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Email</a>,
            –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
        </p>
    </div>
</div>
{% endblock %}
