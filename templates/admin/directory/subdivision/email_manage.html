{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block extrahead %}
{{ block.super }}
<style>
    .manage-container {
        max-width: 900px;
        margin: 40px auto;
        padding: 30px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .info-box {
        background: #e3f2fd;
        border-left: 4px solid #2196F3;
        padding: 20px;
        margin-bottom: 30px;
        border-radius: 4px;
    }
    .info-box h3 {
        margin-top: 0;
        color: #1976D2;
    }
    .info-box ul {
        margin: 10px 0;
        padding-left: 20px;
    }
    .form-section {
        margin: 30px 0;
    }
    .form-section h3 {
        color: #333;
        border-bottom: 2px solid #417690;
        padding-bottom: 10px;
        margin-bottom: 20px;
    }
    .form-group {
        margin: 20px 0;
    }
    .form-group label {
        display: block;
        font-weight: bold;
        margin-bottom: 8px;
        color: #555;
    }
    .form-group select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
    }
    .action-cards {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 30px 0;
    }
    .action-card {
        border: 2px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        cursor: pointer;
        transition: all 0.3s;
    }
    .action-card:hover {
        border-color: #417690;
        background: #f5f9ff;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .action-card input[type="radio"] {
        margin-right: 10px;
        transform: scale(1.2);
    }
    .action-card label {
        cursor: pointer;
        display: flex;
        align-items: center;
        font-size: 16px;
        font-weight: bold;
    }
    .action-card .description {
        margin-top: 10px;
        color: #666;
        font-size: 14px;
        line-height: 1.5;
    }
    .action-card.selected {
        border-color: #417690;
        background: #e7f3ff;
    }
    .submit-button {
        width: 100%;
        padding: 15px;
        background: #417690;
        color: white;
        border: none;
        border-radius: 4px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: background 0.3s;
    }
    .submit-button:hover {
        background: #356a80;
    }
    .submit-button:disabled {
        background: #ccc;
        cursor: not-allowed;
    }
    .back-link {
        display: inline-block;
        margin-top: 20px;
        color: #417690;
        text-decoration: none;
    }
    .back-link:hover {
        text-decoration: underline;
    }
    .warning-box {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 15px;
        margin: 20px 0;
        border-radius: 4px;
    }
    .warning-box strong {
        color: #856404;
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const actionCards = document.querySelectorAll('.action-card');
        const actionRadios = document.querySelectorAll('input[name="action"]');
        const submitButton = document.querySelector('.submit-button');

        actionCards.forEach(card => {
            card.addEventListener('click', function() {
                const radio = this.querySelector('input[type="radio"]');
                radio.checked = true;

                // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å selected —Å–æ –≤—Å–µ—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
                actionCards.forEach(c => c.classList.remove('selected'));
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å selected –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ
                this.classList.add('selected');

                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
                submitButton.disabled = false;
            });
        });

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω–æ –ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        actionRadios.forEach(radio => {
            if (radio.checked) {
                radio.closest('.action-card').classList.add('selected');
                submitButton.disabled = false;
            }
        });
    });
</script>
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">–ì–ª–∞–≤–Ω–∞—è</a>
    &rsaquo; <a href="{% url 'admin:directory_structuralsubdivision_changelist' %}">–°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è</a>
    &rsaquo; –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Email
</div>
{% endblock %}

{% block content %}
<div class="manage-container">
    <h1>üìß {{ title }}</h1>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}" style="padding: 10px; margin: 10px 0; border-radius: 4px;
                {% if message.tags == 'error' %}background: #ffebee; color: #c62828; border-left: 4px solid #f44336;{% endif %}
                {% if message.tags == 'success' %}background: #e8f5e9; color: #2e7d32; border-left: 4px solid #4caf50;{% endif %}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <div class="info-box">
        <h3>‚ÑπÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Email –∞–¥—Ä–µ—Å–∞–º–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h3>
        <p>–ù–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—ã –º–æ–∂–µ—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å email –∞–¥—Ä–µ—Å–∞ –¥–ª—è:</p>
        <ul>
            <li><strong>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π</strong> - –æ–±—â–∏–µ –ø–æ–ª—É—á–∞—Ç–µ–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</li>
            <li><strong>–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π</strong> - email –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π</li>
            <li><strong>–û—Ç–¥–µ–ª–æ–≤</strong> - email –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –æ—Ç–¥–µ–ª–æ–≤</li>
        </ul>
    </div>

    <form method="post">
        {% csrf_token %}

        <div class="form-section">
            <h3>1Ô∏è‚É£ –í—ã–±–µ—Ä–∏—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é</h3>
            <div class="form-group">
                <label for="organization">–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è:</label>
                <select name="organization" id="organization" required>
                    <option value="all">üè¢ –í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ ({{ organizations.count }})</option>
                    {% for org in organizations %}
                    <option value="{{ org.id }}">{{ org.short_name_ru }}</option>
                    {% endfor %}
                </select>
                <p style="color: #666; font-size: 13px; margin-top: 5px;">
                    üí° –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –¥–ª—è —Ä–∞–±–æ—Ç—ã —Ç–æ–ª—å–∫–æ —Å –µ—ë –¥–∞–Ω–Ω—ã–º–∏, –∏–ª–∏ "–í—Å–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏" –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ –≤—Å–µ–º–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏.
                </p>
            </div>
        </div>

        <div class="form-section">
            <h3>2Ô∏è‚É£ –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ</h3>
            <div class="action-cards">
                <div class="action-card">
                    <label>
                        <input type="radio" name="action" value="export">
                        <span>üì§ –≠–∫—Å–ø–æ—Ä—Ç –≤ XLSX</span>
                    </label>
                    <div class="description">
                        –í—ã–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ email –∞–¥—Ä–µ—Å–∞ –≤ —Ñ–∞–π–ª Excel –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                    </div>
                </div>

                <div class="action-card">
                    <label>
                        <input type="radio" name="action" value="import">
                        <span>üì• –ò–º–ø–æ—Ä—Ç –∏–∑ XLSX</span>
                    </label>
                    <div class="description">
                        –ó–∞–≥—Ä—É–∑–∏—Ç—å email –∞–¥—Ä–µ—Å–∞ –∏–∑ —Ñ–∞–π–ª–∞ Excel (–ø–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö)
                    </div>
                </div>
            </div>
        </div>

        <div class="warning-box">
            <strong>‚ö†Ô∏è –í–∞–∂–Ω–æ:</strong> –ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ email –∞–¥—Ä–µ—Å–∞ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –±—É–¥—É—Ç
            <strong>–ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω–µ–Ω—ã</strong> –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ —Ñ–∞–π–ª–∞. –°–Ω–∞—á–∞–ª–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!
        </div>

        <button type="submit" class="submit-button" disabled>
            –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚Üí
        </button>
    </form>

    <a href="{% url 'admin:directory_structuralsubdivision_changelist' %}" class="back-link">
        ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π
    </a>
</div>
{% endblock %}
