{% extends "base.html" %}
{% load static %}

{% block title %}‚öôÔ∏è –¢–û –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è{% endblock %}

{% block extra_css %}
<style>
@media (max-width: 767px) {
    /* –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –≤ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ + –°—Ç–∞—Ç—É—Å */
    .equipment-table thead {
        display: none;
    }

    .equipment-table tbody tr {
        display: block;
        background: #fff;
        border: 1px solid #dee2e6;
        border-radius: 12px;
        padding: 0.75rem 0.75rem 0.35rem;
        margin-bottom: 0.75rem;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
    }

    .equipment-table td {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.5rem;
        padding: 0.35rem 0 0.2rem;
        font-size: 0.95rem;
        line-height: 1.35;
        word-break: break-word;
        overflow-wrap: anywhere;
    }

    /* –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã, –∫—Ä–æ–º–µ –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è (1) –∏ –°—Ç–∞—Ç—É—Å–∞ (8) */
    .equipment-table td:not(:nth-child(1)):not(:nth-child(8)) {
        display: none;
    }

    /* –ü–æ–¥–ø–∏—Å–∏ –∫–æ–ª–æ–Ω–æ–∫ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞ –º–æ–±–∏–ª–∫–∞—Ö */
    .equipment-table td::before {
        content: none;
    }

    .equipment-table .name-cell {
        flex: 1;
    }

    .equipment-table .status-cell {
        justify-content: flex-end;
        min-width: 90px;
        text-align: right;
    }

    .equipment-table td .badge {
        width: fit-content;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row mb-3">
        <div class="col-md-6">
            <h2>‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</h2>
        </div>
        <div class="col-md-6 text-end">
            <div class="btn-group" role="group">
                <button class="btn btn-primary active">
                    üìã –¢–∞–±–ª–∏—Ü–∞
                </button>
                <a href="{% url 'deadline_control:equipment:list_tree' %}" class="btn btn-outline-primary">
                    üå≥ –î–µ—Ä–µ–≤–æ
                </a>
            </div>
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-md-12">
            <a href="{% url 'deadline_control:equipment:create' %}" class="btn btn-primary">
                ‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
            </a>
            <a href="{% url 'deadline_control:equipment:journal' %}" class="btn btn-success ms-2">
                üìÑ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∂—É—Ä–Ω–∞–ª
            </a>
        </div>
    </div>

    {% if equipment_by_organization %}
        {% for organization, equipment_list in equipment_by_organization %}
        <!-- –ë–ª–æ–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ -->
        <div class="card mb-4 border-primary">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">üè¢ {{ organization }}</h4>
            </div>
            <div class="card-body">
                <table class="table table-striped table-hover equipment-table">
                    <thead>
                        <tr>
                            <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
                            <th>–ò–Ω–≤. ‚Ññ</th>
                            <th>–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ</th>
                            <th>–û—Ç–¥–µ–ª</th>
                            <th>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –¢–û</th>
                            <th>–°–ª–µ–¥—É—é—â–µ–µ –¢–û</th>
                            <th>–î–Ω–µ–π –¥–æ –¢–û</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for equipment in equipment_list %}
                        <tr {% if equipment.days_until_maintenance < 0 %}class="table-danger"{% elif equipment.days_until_maintenance <= 7 %}class="table-warning"{% endif %}>
                            <td class="name-cell" data-label="–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ">
                                <a href="{% url 'deadline_control:equipment:detail' equipment.pk %}">
                                    {{ equipment.equipment_name }}
                                </a>
                            </td>
                            <td data-label="–ò–Ω–≤. ‚Ññ">{{ equipment.inventory_number }}</td>
                            <td data-label="–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ">{{ equipment.subdivision.name|default:"-" }}</td>
                            <td data-label="–û—Ç–¥–µ–ª">{{ equipment.department.name|default:"-" }}</td>
                            <td data-label="–ü–æ—Å–ª–µ–¥–Ω–µ–µ –¢–û">{{ equipment.last_maintenance_date|date:"d.m.Y"|default:"-" }}</td>
                            <td data-label="–°–ª–µ–¥—É—é—â–µ–µ –¢–û">{{ equipment.next_maintenance_date|date:"d.m.Y"|default:"-" }}</td>
                            <td data-label="–î–Ω–µ–π –¥–æ –¢–û">
                                {% if equipment.days_until_maintenance is not None %}
                                    {{ equipment.days_until_maintenance }}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td class="status-cell" data-label="–°—Ç–∞—Ç—É—Å">
                                {% if equipment.days_until_maintenance < 0 %}
                                    <span class="badge bg-danger text-white fw-bold">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</span>
                                {% elif equipment.days_until_maintenance <= 7 %}
                                    <span class="badge bg-warning text-dark fw-bold">–°–∫–æ—Ä–æ</span>
                                {% else %}
                                    <span class="badge bg-success text-white fw-bold">OK</span>
                                {% endif %}
                            </td>
                            <td class="actions-cell" data-label="–î–µ–π—Å—Ç–≤–∏—è">
                                <div class="d-flex flex-wrap gap-2">
                                    <a href="{% url 'deadline_control:equipment:update' equipment.pk %}" class="btn btn-sm btn-info flex-fill">‚úèÔ∏è</a>
                                    <a href="{% url 'deadline_control:equipment:delete' equipment.pk %}" class="btn btn-sm btn-danger flex-fill">üóëÔ∏è</a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endfor %}
    {% else %}
    <div class="alert alert-info">
        –ù–µ—Ç –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è. <a href="{% url 'deadline_control:equipment:create' %}">–î–æ–±–∞–≤–∏—Ç—å</a>
    </div>
    {% endif %}
</div>
{% endblock %}
